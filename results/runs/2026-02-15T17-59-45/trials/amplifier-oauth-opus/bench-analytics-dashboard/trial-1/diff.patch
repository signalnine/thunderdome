diff --git a/.amplifier-stdout.log b/.amplifier-stdout.log
new file mode 100644
index 0000000..3db5fd7
--- /dev/null
+++ b/.amplifier-stdout.log
@@ -0,0 +1,1033 @@
+Preparing bundle 'foundation'...
+Bundle 'foundation' prepared successfully
+
+Session ID: fd1298e2-c71d-424f-bbb6-55e31bac9542
+Bundle: foundation | Provider: Anthropic | claude-opus-4-6
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mLet me analyze the task. I need to build a multi-tenant     
+analytics dashboard API in TypeScript. Let me start by      
+exploring the existing project structure to understand      
+what's already in place.[0m
+[90m============================================================[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 37,478 (96% cached) | Output: 471 | Total: 37,949[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: create[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: in_progress[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (30 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: created
+   count: 11
+   todos:
+   - content: Explore project structure and existing files
+     status: in_progress
+   ... (31 more lines)[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mExploring project structure[0m                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mDesign and implement the application architecture[0m        [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement database layer and schema initialization[0m       [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement authentication (register, login, JWT middlewaâ€¦[0m [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement user management (profiles, roles)[0m              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement data ingestion (single + batch events)[0m         [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement dashboard CRUD[0m                                 [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement data export (CSV + JSON)[0m                       [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mWire up routes and createApp entry point[0m                 [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mBuild, lint, and verify[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32m[0m[2;37mâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘[0m 0/11                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+
+[38;5;110mâ–¸[0m [38;5;188mLet me explore the project structure first.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 38,446 (93% cached) | Output: 196 | Total: 38,642[0m
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace
+   content: |
+       Directory: /workspace
+       
+         DIR  .amplifier
+   ... (15 more lines)[0m
+
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/package.json[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/package.json
+   content: |
+            1	{
+            2	  "name": "bench-analytics-dashboard",
+            3	  "version": "1.0.0",
+   ... (34 more lines)[0m
+
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/tsconfig.json[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/tsconfig.json
+   content: |
+            1	{
+            2	  "compilerOptions": {
+            3	    "strict": true,
+   ... (16 more lines)[0m
+
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/schema.sql[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/schema.sql
+   content: |
+            1	-- Multi-tenant analytics dashboard schema
+            2	CREATE TABLE IF NOT EXISTS users (
+            3	  id TEXT PRIMARY KEY,
+   ... (48 more lines)[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 40,623 (88% cached) | Output: 151 | Total: 40,774[0m
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/src[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/src
+   content: |
+       Directory: /workspace/src
+       
+         FILE .gitkeep
+   ... (2 more lines)[0m
+
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/.eslintrc.cjs[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/.eslintrc.cjs
+   content: |
+            1	module.exports = {
+            2	  parser: '@typescript-eslint/parser',
+            3	  plugins: ['@typescript-eslint'],
+   ... (15 more lines)[0m
+
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/vitest.config.ts[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/vitest.config.ts
+   content: |
+            1	import { defineConfig } from 'vitest/config';
+            2	
+            3	export default defineConfig({
+   ... (8 more lines)[0m
+
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mNow I have a clear picture of the project. Let me plan the  
+architecture and implement everything. The project uses:    
+
+ â€¢ Express for HTTP                                         
+ â€¢ better-sqlite3 for SQLite                                
+ â€¢ jsonwebtoken for JWT                                     
+ â€¢ uuid for IDs                                             
+ â€¢ TypeScript with strict mode, ES2022, Node16 modules      
+
+Let me design the file structure:                           
+
+                                                            
+ src/                                                       
+   app.ts          - createApp function, main entry point   
+   db.ts           - Database initialization and helpers    
+   middleware/                                              
+     auth.ts       - JWT authentication middleware          
+   routes/                                                  
+     auth.ts       - Register, login routes                 
+     users.ts      - User management (profile, roles)       
+     events.ts     - Event ingestion                        
+     queries.ts    - Query engine                           
+     dashboards.ts - Dashboard CRUD                         
+     export.ts     - Data export                            
+   types.ts        - Shared type definitions                
+                                                            
+
+I'll implement all the files now with these key design      
+decisions: createApp exported from src/app.ts as the main   
+entry point, JWT secret configurable via environment or     
+default, password hashing using Node's built-in crypto with 
+pbkdf2 since bcrypt isn't available, and all queries scoped 
+to tenants.                                                 
+
+I need to make sure queries filter by tenant_id from the JWT
+token, and with "module": "Node16" in tsconfig, I'll need to
+handle the module system carefully. Since there's no "type":
+"module" in package.json, this is CommonJS, so I need to be 
+mindful of how imports work with the Node16 module          
+resolution.                                                 
+
+Implementing the files... I'm going back and forth on this â€”
+with Node16 moduleResolution and no "type": "module",       
+TypeScript compiles .ts files as CommonJS, which means I    
+don't need file extensions in imports since that's only     
+required for ESM.                                           
+
+But Node16 is stricter about module resolution, so to be    
+safe I'll just use .js extensions on all relative imports â€” 
+TypeScript will understand that .js refers to the .ts source
+file.                                                       
+
+Now I'm ready to write the full implementation, starting    
+with the types and then moving into the password hashing    
+logic using Node's built-in crypto module since bcrypt isn't
+available.                                                  
+
+Defining the data structures... Defining the database       
+initialization... I'm reconsidering whether to embed the    
+schema directly in the code to avoid file path              
+complications, or keep it separate. Actually, embedding it  
+makes the most senseâ€”no runtime path resolution issues to   
+worry about. Now I'm thinking through the overall project   
+structure to keep things clean without over-engineering: a  
+relatively flat layout with the main app logic, database    
+setup, types, and auth middleware in the src root, plus a   
+routes subdirectory for route handlers.                     
+
+Hmm, but that's getting unwieldy with too many individual   
+route files...                                              
+
+let me consolidate into a cleaner structure with a routes   
+directory instead. I'll organize it as src/app.ts,          
+src/db.ts, src/types.ts, src/middleware.ts, and then a      
+routes/ folder containing auth.ts, users.ts, events.ts,     
+queries.ts, dashboards.ts, and export.ts. For password      
+hashing, since bcrypt isn't available, I'll use Node's      
+built-in crypto module with scryptSync.                     
+
+Setting up password hashing...                              
+
+Now I'm thinking through the API routes I need to build,    
+starting with the auth endpoints for registration and login.
+I need to be careful with TypeScript strict mode, especially
+around the better-sqlite3 Database type and how I extend    
+Express's Request interface to include the authenticated    
+user. I'm planning to set up router factory functions that  
+accept the database instance and return configured Express  
+routers, with JWT authentication using a configurable       
+secret.                                                     
+
+Writing the route handlers... Writing out the route         
+handlers...                                                 
+
+Now I'm thinking through the module resolution issue with   
+Node16 and CommonJSâ€”whether relative imports need .js       
+extensions. In CJS mode, Node's require() handles extension 
+resolution automatically, so import x from './foo' should   
+resolve to ./foo.js without needing to specify it           
+explicitly.                                                 
+
+I'll go ahead and use .js extensions to be safe, since      
+TypeScript's Node16 moduleResolution will map them back to  
+the .ts source files anyway.                                
+
+Before writing the code, I'm planning the implementation:   
+I'll embed the database schema directly in db.ts to avoid   
+runtime file path issues, and I'll use declaration merging  
+to properly type req.user in the middleware since it might  
+be undefined in strict TypeScript.                          
+
+Writing the implementation files... Writing the auth        
+middleware...                                               
+
+I'm defining a middleware function that extracts the JWT    
+token from the Authorization header, verifies it using the  
+secret, and attaches the decoded user data to the request   
+object so route handlers can access it. This approach with  
+the custom AuthRequest interface keeps things type-safe     
+throughout the application.                                 
+
+Actually, I'm reconsidering thisâ€”using TypeScript           
+declaration merging to extend the standard Express Request  
+type would be cleaner, so I don't need a separate interface 
+everywhere. I can add the user property directly to         
+Express's Request type in a types file, which means all     
+route handlers automatically get access to req.user without 
+any extra type annotations.                                 
+
+Now I'm thinking through the query engine design. I need to 
+handle three main query patterns: counting events with      
+optional date filtering, generating timeseries data grouped 
+by different time intervals like hours or days, and breaking
+down events by property values with counts.                 
+
+For the timeseries queries, SQLite has built-in functions   
+for different granularitiesâ€”date() for daily buckets,       
+strftime() with various format strings for hourly, weekly,  
+and monthly groupings.                                      
+
+On the export side, I'll keep it simple with a basic CSV    
+builder and JSON serialization, then I need to think through
+the filter parameters: event names, date ranges, and        
+property-based filtering where users can specify something  
+like {"url": "/home"}. For the breakdown queries, I'll need 
+a parameter to specify which property to group by.          
+
+Now I'm working through the better-sqlite3 types and how the
+import should work with TypeScriptâ€”the default export is the
+constructor function, and calling new Database() gives me an
+instance of the Database.Database type.                     
+
+Writing the implementation files... Setting up the Express  
+app factory function...                                     
+
+I'm configuring the JWT secret from environment variables   
+with a fallback, then mounting all the route handlers with  
+the authentication middleware applied to everything except  
+the auth routes themselves. I should also make sure to      
+export this createApp function from the main entry point so 
+it's accessible to consumers of the module. I'm going to    
+stop planning and start writing the code now. I'll batch all
+the file creations together: the type definitions, database 
+setup, middleware, and all the route handlers for           
+authentication, users, events, queries, and dashboards.     
+
+I need to be careful with TypeScript strictness hereâ€”Express
+route handlers should return void, and since I'm using      
+declaration merging for req.user, it's optional, so I'll    
+need to handle cases where it might be undefined even in    
+protected routes.                                           
+
+Writing the files... I'm debating whether to use .js        
+extensions for Node16 module resolutionâ€”TypeScript should   
+resolve them back to the source files anyway, so I'll go    
+with that for safety. Now I'm actually writing the code,    
+starting with the type definitions for the authenticated    
+user and Express request augmentation, then setting up the  
+database module.                                            
+
+Setting up database schema... Setting up database indexes on
+the key fields for performance, then defining the           
+initialization function that configures the SQLite database 
+with WAL mode and foreign key constraints before executing  
+the schema. Now I'm moving into the middleware setup where  
+I'll handle JWT authentication and request validation. I    
+need to make sure the types file is properly set up as a    
+module so the declaration merging works correctlyâ€”since it  
+already exports the AuthUser interface, TypeScript will     
+treat it as a module and include it in compilation, which   
+means the global augmentation will take effect across the   
+entire program without needing an explicit import in the    
+middleware file.                                            
+
+Now I'm looking at what each route file exports to          
+understand the structure I need to work with.               
+
+For the crypto import, I should use the standard Node.js    
+crypto moduleâ€”with esModuleInterop: true, the import        
+statement will work correctly regardless of whether I use   
+the node: prefix or not.                                    
+
+Let me finalize my approach and start writing out the       
+implementation.                                             
+
+Now I'm mapping out the API contract for each route,        
+thinking through the request and response shapes for        
+authentication, user management, and event handling         
+endpoints. Defining the query endpoints for counting events,
+generating time series data, and breaking down metrics by   
+property, then laying out the dashboard management routes   
+for CRUD operations, and finally the export functionality   
+for downloading events in different formats.                
+
+Now I'm thinking through the TypeScript types for Express   
+handlersâ€”specifically how to handle the return types        
+correctly when chaining methods like res.status().json()    
+without running into strict type checking issues. I'm       
+realizing that TypeScript's void return type is actually    
+permissive in callback contextsâ€”return res.json(...) should 
+work fine. But to keep things simple and avoid any potential
+issues, I'll stick with either calling res.json(...) without
+a return statement, or using res.json(...); return; as      
+separate statements for early exits in error handling.      
+
+Now I need to actually write the code. First, let me figure 
+out the module extension situationâ€”my tsconfig has "module":
+"Node16" and "moduleResolution": "Node16", but the          
+package.json doesn't have "type": "module", so these are    
+CommonJS files. With Node16 module resolution, TypeScript   
+requires explicit .js extensions on all relative imports,   
+even for CJS, or it throws an error. I'm going back and     
+forth on whether TypeScript requires file extensions in     
+CommonJS mode with Node16 resolution, but since require()   
+doesn't need them, it should be fine without extensions. To 
+be safe and avoid a failed build, I'll just add .js         
+extensions to everything. Now I'm actually writing the      
+codeâ€”I need to import uuid with the named export v4 and     
+crypto as a default import, then put together all the files.
+
+Writing the type definitions and database setup... I'm      
+reconsidering the catch clause syntaxâ€”modern TypeScript     
+allows an empty catch block, but I should verify whether the
+ESLint configuration will accept it or if I need to         
+explicitly name the error variable with an underscore prefix
+to follow the project's unused variable rules.              
+
+Now I'm setting up the auth routes file with the necessary  
+imports for Express, database access, JWT handling, and UUID
+generation, then starting to define the password hashing    
+function.                                                   
+
+Implementing password utilities and the auth router...      
+Writing the authentication endpoints... I'm realizing the as
+any cast isn't ideal for TypeScript strict mode, so I should
+define proper interfaces for the database row types instead.
+Since better-sqlite3's .get() returns unknown, I need to    
+cast to a typed interface like UserRow that includes all the
+fields I'm expecting from the users table.                  
+
+Now I'm planning out the implementation strategyâ€”I'll       
+organize the code into batches: first the core types and    
+database setup, then the route handlers, and finally the    
+query utilities. I can create the directory structure       
+implicitly by writing files to their paths.                 
+
+Writing the implementation files...                         
+
+Actually, I should verify the dependencies are installed and
+be mindful of the ESLint rules, particularly around avoiding
+explicit any types, so I'll need to use proper type casting 
+with the sqlite3 results.                                   
+
+For the JWT handling, I need to check whether the decoded   
+token is a string or object since jwt.verify can return     
+either, and handle that appropriately before accessing the  
+payload properties.                                         
+
+Writing TypeScript code...                                  
+
+Now I'm reconsidering the import extensionsâ€”with TypeScript 
+5.4 in Node16 mode treating .ts files as CommonJS, relative 
+imports should resolve without explicit .js extensions since
+Node's require handles that automatically. I'll skip the    
+extensions for now and add them if the build fails.         
+
+Actually, I should just use .js extensions to be safe.      
+TypeScript will resolve them to the .ts source files anyway,
+and it's the recommended approach for Node16 module         
+resolution.                                                 
+
+Writing import statements...[0m
+[90m============================================================[0m
+
+
+[38;5;103mâ–[0m [38;5;145mGood, I have a clear picture of the project. Empty src/     [0m
+[38;5;103mâ–[0m [38;5;145mdirectory, provided schema.sql, all dependencies listed. Let[0m
+[38;5;103mâ–[0m [38;5;145mme design and implement the full API.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 41,275 (87% cached) | Output: 13,204 | Total: 54,479[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (24 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 9
+   pending: 7
+   in_progress: 1
+   completed: 1[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mInstalling dependencies[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mBuild, lint, and verify[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘[0m 1/9                               [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 54,186 (66% cached) | Output: 89 | Total: 54,275[0m
+
+[36mğŸ”§ Using tool: bash[0m
+   [2mcommand: cd /workspace && ls node_modules/.package-lock.json 2>/dev/null || echo "need install" && npm install 2>&1 | tail -5[0m
+[36mâœ… Tool result: bash[0m
+[2m   need install
+   npm notice
+   npm notice New major version of npm available! 10.8.2 -> 11.10.0
+   npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.10.0
+   npm notice To update run: npm install -g npm@11.10.0
+   ... (2 more lines)[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 54,396 (66% cached) | Output: 350 | Total: 54,746[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (24 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 9
+   pending: 6
+   in_progress: 1
+   completed: 2[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mImplementing foundational layers[0m                         [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mBuild, lint, and verify[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘[0m 2/9                               [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+
+[38;5;110mâ–¸[0m [38;5;188mNow let me write all the source files. I'll start with the  [0m
+  [38;5;188mfoundational layers.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 54,787 (65% cached) | Output: 395 | Total: 55,182[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/types.ts[0m
+   [2mcontent: |[0m
+   [2m    export interface AuthUser {[0m
+   [2m      userId: string;[0m
+   [2m      email: string;[0m
+   [2m... (52 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/types.ts
+   bytes: 876[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 55,220 (65% cached) | Output: 960 | Total: 56,180[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/db.ts[0m
+   [2mcontent: |[0m
+   [2m    import Database from "better-sqlite3";[0m
+   [2m    [0m
+   [2m    const SCHEMA = `[0m
+   [2m... (57 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/db.ts
+   bytes: 1928[0m
+
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/middleware.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Request, Response, NextFunction } from "express";[0m
+   [2m    import jwt from "jsonwebtoken";[0m
+   [2m    [0m
+   [2m... (27 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/middleware.ts
+   bytes: 925[0m
+
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mGood, the foundational files are written. Let me continue   
+with the route files. I'll write them all now.[0m
+[90m============================================================[0m
+
+
+[38;5;110mâ–¸[0m [38;5;188mNow let me write all the route files and the app entry      [0m
+  [38;5;188mpoint.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 56,297 (64% cached) | Output: 2,818 | Total: 59,115[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/auth.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    import jwt from "jsonwebtoken";[0m
+   [2m... (122 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/auth.ts
+   bytes: 3243[0m
+
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/users.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    import type { UserRow } from "../types.js";[0m
+   [2m... (87 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/users.ts
+   bytes: 2322[0m
+
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/events.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    import { v4 as uuidv4 } from "uuid";[0m
+   [2m... (102 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/events.ts
+   bytes: 2809[0m
+
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mLet me continue writing the remaining route files and the   
+app.ts entry point. I need to write:                        
+
+ 1 routes/queries.ts                                        
+ 2 routes/dashboards.ts                                     
+ 3 routes/export.ts                                         
+ 4 app.ts                                                   
+
+Let me update the todo and continue writing.[0m
+[90m============================================================[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 59,260 (60% cached) | Output: 426 | Total: 59,686[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (24 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 9
+   pending: 3
+   in_progress: 1
+   completed: 5[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mImplementing query engine[0m                                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mBuild, lint, and verify[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘[0m 5/9                               [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 59,724 (60% cached) | Output: 4,016 | Total: 63,740[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/queries.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    [0m
+   [2m... (136 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/queries.ts
+   bytes: 3623[0m
+
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/dashboards.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    import { v4 as uuidv4 } from "uuid";[0m
+   [2m... (172 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/dashboards.ts
+   bytes: 4946[0m
+
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/routes/export.ts[0m
+   [2mcontent: |[0m
+   [2m    import { Router, Request, Response } from "express";[0m
+   [2m    import type Database from "better-sqlite3";[0m
+   [2m    import type { EventRow, DashboardRow } from "../types.js";[0m
+   [2m... (117 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/routes/export.ts
+   bytes: 3680[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 63,894 (56% cached) | Output: 350 | Total: 64,244[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (24 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 9
+   pending: 1
+   in_progress: 1
+   completed: 7[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mWiring up entry point[0m                                    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mBuild, lint, and verify[0m                                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘â–‘â–‘â–‘[0m 7/9                               [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 64,291 (56% cached) | Output: 435 | Total: 64,726[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/src/app.ts[0m
+   [2mcontent: |[0m
+   [2m    import express from "express";[0m
+   [2m    import { initializeDatabase } from "./db.js";[0m
+   [2m    import { authMiddleware } from "./middleware.js";[0m
+   [2m... (31 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/src/app.ts
+   bytes: 1220[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 64,765 (55% cached) | Output: 379 | Total: 65,144[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (27 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 10
+   pending: 1
+   in_progress: 1
+   completed: 8[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mBuilding and fixing TypeScript errors[0m                    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;37mâ—‹[0m [2;37mRun lint and fix any issues[0m                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘â–‘â–‘[0m 8/10                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+
+[38;5;110mâ–¸[0m [38;5;188mNow let me build and fix any issues.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 65,200 (55% cached) | Output: 72 | Total: 65,272[0m
+
+[36mğŸ”§ Using tool: bash[0m
+   [2mcommand: cd /workspace && npm run build 2>&1[0m
+[36mâœ… Tool result: bash[0m
+[2m   
+   > bench-analytics-dashboard@1.0.0 build
+   > tsc
+   
+   [0m
+
+
+[38;5;110mâ–¸[0m [38;5;188mBuild succeeded. Now let me run the linter.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 65,322 (55% cached) | Output: 74 | Total: 65,396[0m
+
+[36mğŸ”§ Using tool: bash[0m
+   [2mcommand: cd /workspace && npm run lint 2>&1[0m
+[36mâŒ Tool result: bash[0m
+[2m   
+   > bench-analytics-dashboard@1.0.0 lint
+   > eslint src/
+   
+   
+   ... (6 more lines)[0m
+
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mI need to fix the ESLint error about namespace usage in     
+types.ts. The issue is with the declare global { namespace  
+Express { ... } } pattern. I need to find an alternative    
+approach.                                                   
+
+The best fix is to use module augmentation differently. I   
+can use a .d.ts file or I can disable the rule for that     
+specific line. Actually, the cleanest approach is to use an 
+eslint-disable comment for that specific line since         
+namespace augmentation of Express is the standard pattern.  
+
+Let me fix the types.ts file.[0m
+[90m============================================================[0m
+
+
+[38;5;103mâ–[0m [38;5;145mNeed to fix the ESLint namespace error in types.ts. The     [0m
+[38;5;103mâ–[0m [38;5;145mdeclare global { namespace Express } pattern is the standard[0m
+[38;5;103mâ–[0m [38;5;145mway to augment Express types, so I'll add a targeted disable[0m
+[38;5;103mâ–[0m [38;5;145mcomment.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 65,514 (55% cached) | Output: 239 | Total: 65,753[0m
+
+[36mğŸ”§ Using tool: read_file[0m
+   [2mfile_path: /workspace/src/types.ts[0m
+[36mâœ… Tool result: read_file[0m
+[2m   file_path: /workspace/src/types.ts
+   content: |
+            1	export interface AuthUser {
+            2	  userId: string;
+            3	  email: string;
+   ... (54 more lines)[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 66,291 (54% cached) | Output: 173 | Total: 66,464[0m
+
+[36mğŸ”§ Using tool: edit_file[0m
+   [2mfile_path: /workspace/src/types.ts[0m
+   [2mold_string: |[0m
+   [2m    declare global {[0m
+   [2m      namespace Express {[0m
+   [2m        interface Request {[0m
+   [2m... (13 more lines)[0m
+[36mâœ… Tool result: edit_file[0m
+[2m   file_path: /workspace/src/types.ts
+   replacements_made: 1
+   bytes_written: 938[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 66,505 (54% cached) | Output: 71 | Total: 66,576[0m
+
+[36mğŸ”§ Using tool: bash[0m
+   [2mcommand: cd /workspace && npm run build 2>&1 && npm run lint 2>&1[0m
+[36mâœ… Tool result: bash[0m
+[2m   
+   > bench-analytics-dashboard@1.0.0 build
+   > tsc
+   
+   
+   ... (4 more lines)[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 66,653 (54% cached) | Output: 407 | Total: 67,060[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (30 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 11
+   pending: 0
+   in_progress: 1
+   completed: 10[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mBuild and fix TypeScript compilation errors[0m              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mRun lint and fix any issues[0m                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [1;36mâ–¶[0m [1;36mWriting and running integration tests[0m                    [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37mâ–‘â–‘â–‘[0m 10/11                             [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+
+[90m============================================================[0m
+[90mThinking:[0m
+[90m------------------------------------------------------------[0m
+[2mThe build and lint both pass. Now let me write integration  
+tests to verify the implementation works correctly before   
+presenting it as done.[0m
+[90m============================================================[0m
+
+
+[38;5;103mâ–[0m [38;5;145mBuild and lint both pass cleanly. Now let me write          [0m
+[38;5;103mâ–[0m [38;5;145mintegration tests to verify the implementation actually     [0m
+[38;5;103mâ–[0m [38;5;145mworks end-to-end.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 67,112 (53% cached) | Output: 6,309 | Total: 73,421[0m
+
+[36mğŸ”§ Using tool: write_file[0m
+   [2mfile_path: /workspace/tests/integration.test.ts[0m
+   [2mcontent: |[0m
+   [2m    import { describe, it, expect, beforeEach } from "vitest";[0m
+   [2m    import request from "supertest";[0m
+   [2m    import { createApp } from "../src/app.js";[0m
+   [2m... (617 more lines)[0m
+[36mâœ… Tool result: write_file[0m
+[2m   file_path: /workspace/tests/integration.test.ts
+   bytes: 19535[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 73,432 (49% cached) | Output: 61 | Total: 73,493[0m
+
+[36mğŸ”§ Using tool: bash[0m
+   [2mcommand: cd /workspace && npm test 2>&1[0m
+[36mâœ… Tool result: bash[0m
+[2m   
+   > bench-analytics-dashboard@1.0.0 test
+   > vitest run
+   
+   [33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
+   ... (11 more lines)[0m
+
+
+[38;5;110mâ–¸[0m [38;5;188mAll 40 tests pass. Let me mark the task complete.[0m
+
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 73,722 (48% cached) | Output: 420 | Total: 74,142[0m
+
+[36mğŸ”§ Using tool: todo[0m
+   [2maction: update[0m
+   [2mtodos:[0m
+   [2m- content: Explore project structure and existing files[0m
+   [2m  status: completed[0m
+   [2m  activeForm: Exploring project structure[0m
+   [2m... (30 more lines)[0m
+[36mâœ… Tool result: todo[0m
+[2m   status: updated
+   count: 11
+   pending: 0
+   in_progress: 0
+   completed: 11[0m
+
+
+[2;37mâ”Œâ”€ Todo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mExplore project structure and existing files[0m             [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mInstall dependencies and verify toolchain[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement types, database layer, and auth middleware[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement auth routes (register, login)[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement user management and event ingestion routes[0m     [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement query engine (count, timeseries, breakdown)[0m    [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mImplement dashboard CRUD and export routes[0m               [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mWire up app.ts entry point with createApp[0m                [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mBuild and fix TypeScript compilation errors[0m              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mRun lint and fix any issues[0m                              [2;37mâ”‚[0m
+[2;37mâ”‚[0m [2;32mâœ“[0m [2;32mWrite and run integration tests[0m                          [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ”‚[0m [32mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[0m[2;37m[0m 11/11 [1;32mâœ“ Complete[0m                  [2;37mâ”‚[0m
+[2;37mâ”‚[0m                                                            [2;37mâ”‚[0m
+[2;37mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜[0m
+[2mâ”‚  ğŸ“Š Token Usage[0m
+[2mâ””â”€ Input: 74,185 (48% cached) | Output: 438 | Total: 74,623[0m
+The multi-tenant analytics dashboard API is fully implemented, compiled, linted,
+and tested. Here's a summary:                                                   
+
+
+Architecture                                                                    
+
+                                                                                
+ src/                                                                           
+   app.ts            - createApp() entry point, route wiring                    
+   db.ts             - SQLite initialization with embedded schema               
+   types.ts          - Shared TypeScript types + Express augmentation           
+   middleware.ts      - JWT authentication middleware                           
+   routes/                                                                      
+     auth.ts         - POST /auth/register, POST /auth/login                    
+     users.ts        - GET /users/me, PUT /users/:userId/role                   
+     events.ts       - POST /events, POST /events/batch                         
+     queries.ts      - POST /queries/count, /timeseries, /breakdown             
+     dashboards.ts   - Full CRUD on /dashboards                                 
+     export.ts       - GET /export/events, GET /export/dashboards/:id           
+                                                                                
+
+
+Key Design Decisions                                                            
+
+ â€¢ Password hashing uses Node.js built-in crypto.scryptSync (no extra           
+   dependencies needed)                                                         
+ â€¢ JWT tokens carry userId, email, tenantId, and role -- the auth middleware    
+   extracts these and attaches to req.user                                      
+ â€¢ Tenant isolation is enforced at every query level -- all data-access queries 
+   include WHERE tenant_id = ? from the authenticated user's JWT                
+ â€¢ Database is initialized with the schema embedded directly in db.ts to avoid  
+   runtime file-path issues                                                     
+ â€¢ Route factories accept db as a parameter, making everything testable with    
+   in-memory SQLite                                                             
+
+
+Verification Results                                                            
+
+ â€¢ npm run build -- compiles cleanly with strict TypeScript (ES2022, Node16)    
+ â€¢ npm run lint -- passes ESLint with zero errors                               
+ â€¢ npm test -- 40 integration tests pass, covering auth, user management,       
+   events, queries, dashboards, export, and tenant isolation                    
+
diff --git a/.amplifier/settings.local.yaml b/.amplifier/settings.local.yaml
new file mode 100644
index 0000000..64831cc
--- /dev/null
+++ b/.amplifier/settings.local.yaml
@@ -0,0 +1,11 @@
+config:
+  providers:
+  - config:
+      api_key: ${ANTHROPIC_API_KEY}
+      base_url: https://api.anthropic.com
+      default_model: claude-opus-4-6
+      enable_1m_context: 'true'
+      enable_prompt_caching: 'true'
+      priority: 1
+    module: provider-anthropic
+    source: /opt/amplifier-provider-anthropic
diff --git a/.thunderdome-metrics.json b/.thunderdome-metrics.json
new file mode 100644
index 0000000..a5cf315
--- /dev/null
+++ b/.thunderdome-metrics.json
@@ -0,0 +1,7 @@
+{
+  "input_tokens": 38577,
+  "output_tokens": 438,
+  "cache_read_tokens": 35608,
+  "cache_creation_tokens": 0,
+  "total_cost_usd": 0.664917
+}
\ No newline at end of file
diff --git a/.thunderdome-stderr.log b/.thunderdome-stderr.log
new file mode 100644
index 0000000..cadd514
--- /dev/null
+++ b/.thunderdome-stderr.log
@@ -0,0 +1,12 @@
+
+[36mğŸ§  Thinking...[0m
+
+[36mğŸ§  Thinking...[0m
+
+[36mğŸ§  Thinking...[0m
+
+[36mğŸ§  Thinking...[0m
+
+[36mğŸ§  Thinking...[0m
+
+[36mğŸ§  Thinking...[0m
diff --git a/package-lock.json b/package-lock.json
index 16cc798..53f6fc4 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -22,12 +22,84 @@
         "@types/uuid": "^10.0.0",
         "@typescript-eslint/eslint-plugin": "^7.0.0",
         "@typescript-eslint/parser": "^7.0.0",
+        "@vitest/coverage-v8": "^2.0.0",
         "eslint": "^8.56.0",
         "supertest": "^7.0.0",
         "typescript": "^5.4.0",
         "vitest": "^2.0.0"
       }
     },
+    "node_modules/@ampproject/remapping": {
+      "version": "2.3.0",
+      "resolved": "https://registry.npmjs.org/@ampproject/remapping/-/remapping-2.3.0.tgz",
+      "integrity": "sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==",
+      "dev": true,
+      "license": "Apache-2.0",
+      "dependencies": {
+        "@jridgewell/gen-mapping": "^0.3.5",
+        "@jridgewell/trace-mapping": "^0.3.24"
+      },
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
+    "node_modules/@babel/helper-string-parser": {
+      "version": "7.27.1",
+      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
+      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@babel/helper-validator-identifier": {
+      "version": "7.28.5",
+      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",
+      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@babel/parser": {
+      "version": "7.29.0",
+      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.29.0.tgz",
+      "integrity": "sha512-IyDgFV5GeDUVX4YdF/3CPULtVGSXXMLh1xVIgdCgxApktqnQV0r7/8Nqthg+8YLGaAtdyIlo2qIdZrbCv4+7ww==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/types": "^7.29.0"
+      },
+      "bin": {
+        "parser": "bin/babel-parser.js"
+      },
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
+    "node_modules/@babel/types": {
+      "version": "7.29.0",
+      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.29.0.tgz",
+      "integrity": "sha512-LwdZHpScM4Qz8Xw2iKSzS+cfglZzJGvofQICy7W7v4caru4EaAmyUuO6BGrbyQ2mYV11W0U8j5mBhd14dd3B0A==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/helper-string-parser": "^7.27.1",
+        "@babel/helper-validator-identifier": "^7.28.5"
+      },
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@bcoe/v8-coverage": {
+      "version": "0.2.3",
+      "resolved": "https://registry.npmjs.org/@bcoe/v8-coverage/-/v8-coverage-0.2.3.tgz",
+      "integrity": "sha512-0hYQ8SB4Db5zvZB4axdMHGwEaQjkZzFjQiN9LVYvIFB2nSUHW9tYpxWriPrWDASIxiaXax83REcLxuSdnGPZtw==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/@esbuild/aix-ppc64": {
       "version": "0.21.5",
       "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.21.5.tgz",
@@ -568,6 +640,84 @@
       "dev": true,
       "license": "BSD-3-Clause"
     },
+    "node_modules/@isaacs/cliui": {
+      "version": "8.0.2",
+      "resolved": "https://registry.npmjs.org/@isaacs/cliui/-/cliui-8.0.2.tgz",
+      "integrity": "sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "string-width": "^5.1.2",
+        "string-width-cjs": "npm:string-width@^4.2.0",
+        "strip-ansi": "^7.0.1",
+        "strip-ansi-cjs": "npm:strip-ansi@^6.0.1",
+        "wrap-ansi": "^8.1.0",
+        "wrap-ansi-cjs": "npm:wrap-ansi@^7.0.0"
+      },
+      "engines": {
+        "node": ">=12"
+      }
+    },
+    "node_modules/@isaacs/cliui/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/@isaacs/cliui/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
+    "node_modules/@istanbuljs/schema": {
+      "version": "0.1.3",
+      "resolved": "https://registry.npmjs.org/@istanbuljs/schema/-/schema-0.1.3.tgz",
+      "integrity": "sha512-ZXRY4jNvVgSVQ8DL3LTcakaAtXwTVUxE81hslsyD2AtoXW/wVob10HkOJ1X/pAlcI7D+2YoZKg5do8G/w6RYgA==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/@jridgewell/gen-mapping": {
+      "version": "0.3.13",
+      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
+      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@jridgewell/sourcemap-codec": "^1.5.0",
+        "@jridgewell/trace-mapping": "^0.3.24"
+      }
+    },
+    "node_modules/@jridgewell/resolve-uri": {
+      "version": "3.1.2",
+      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
+      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
     "node_modules/@jridgewell/sourcemap-codec": {
       "version": "1.5.5",
       "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
@@ -575,6 +725,17 @@
       "dev": true,
       "license": "MIT"
     },
+    "node_modules/@jridgewell/trace-mapping": {
+      "version": "0.3.31",
+      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",
+      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@jridgewell/resolve-uri": "^3.1.0",
+        "@jridgewell/sourcemap-codec": "^1.4.14"
+      }
+    },
     "node_modules/@noble/hashes": {
       "version": "1.8.0",
       "resolved": "https://registry.npmjs.org/@noble/hashes/-/hashes-1.8.0.tgz",
@@ -636,6 +797,17 @@
         "@noble/hashes": "^1.1.5"
       }
     },
+    "node_modules/@pkgjs/parseargs": {
+      "version": "0.11.0",
+      "resolved": "https://registry.npmjs.org/@pkgjs/parseargs/-/parseargs-0.11.0.tgz",
+      "integrity": "sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==",
+      "dev": true,
+      "license": "MIT",
+      "optional": true,
+      "engines": {
+        "node": ">=14"
+      }
+    },
     "node_modules/@rollup/rollup-android-arm-eabi": {
       "version": "4.57.1",
       "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.57.1.tgz",
@@ -1102,7 +1274,6 @@
       "integrity": "sha512-m0jEgYlYz+mDJZ2+F4v8D1AyQb+QzsNqRuI7xg1VQX/KlKS0qT9r1Mo16yo5F/MtifXFgaofIFsdFMox2SxIbQ==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "undici-types": "~7.16.0"
       }
@@ -1225,7 +1396,6 @@
       "integrity": "sha512-4Z+L8I2OqhZV8qA132M4wNL30ypZGYOQVBfMgxDH/K5UX0PNqTu1c6za9ST5r9+tavvHiTWmBnKzpCJ/GlVFtg==",
       "dev": true,
       "license": "BSD-2-Clause",
-      "peer": true,
       "dependencies": {
         "@typescript-eslint/scope-manager": "7.18.0",
         "@typescript-eslint/types": "7.18.0",
@@ -1386,6 +1556,39 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/@vitest/coverage-v8": {
+      "version": "2.1.9",
+      "resolved": "https://registry.npmjs.org/@vitest/coverage-v8/-/coverage-v8-2.1.9.tgz",
+      "integrity": "sha512-Z2cOr0ksM00MpEfyVE8KXIYPEcBFxdbLSs56L8PO0QQMxt/6bDj45uQfxoc96v05KW3clk7vvgP0qfDit9DmfQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@ampproject/remapping": "^2.3.0",
+        "@bcoe/v8-coverage": "^0.2.3",
+        "debug": "^4.3.7",
+        "istanbul-lib-coverage": "^3.2.2",
+        "istanbul-lib-report": "^3.0.1",
+        "istanbul-lib-source-maps": "^5.0.6",
+        "istanbul-reports": "^3.1.7",
+        "magic-string": "^0.30.12",
+        "magicast": "^0.3.5",
+        "std-env": "^3.8.0",
+        "test-exclude": "^7.0.1",
+        "tinyrainbow": "^1.2.0"
+      },
+      "funding": {
+        "url": "https://opencollective.com/vitest"
+      },
+      "peerDependencies": {
+        "@vitest/browser": "2.1.9",
+        "vitest": "2.1.9"
+      },
+      "peerDependenciesMeta": {
+        "@vitest/browser": {
+          "optional": true
+        }
+      }
+    },
     "node_modules/@vitest/expect": {
       "version": "2.1.9",
       "resolved": "https://registry.npmjs.org/@vitest/expect/-/expect-2.1.9.tgz",
@@ -1518,7 +1721,6 @@
       "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "bin": {
         "acorn": "bin/acorn"
       },
@@ -2140,6 +2342,13 @@
         "node": ">= 0.4"
       }
     },
+    "node_modules/eastasianwidth": {
+      "version": "0.2.0",
+      "resolved": "https://registry.npmjs.org/eastasianwidth/-/eastasianwidth-0.2.0.tgz",
+      "integrity": "sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/ecdsa-sig-formatter": {
       "version": "1.0.11",
       "resolved": "https://registry.npmjs.org/ecdsa-sig-formatter/-/ecdsa-sig-formatter-1.0.11.tgz",
@@ -2155,6 +2364,13 @@
       "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
       "license": "MIT"
     },
+    "node_modules/emoji-regex": {
+      "version": "9.2.2",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
+      "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/encodeurl": {
       "version": "2.0.0",
       "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
@@ -2291,7 +2507,6 @@
       "deprecated": "This version is no longer supported. Please see https://eslint.org/version-support for other options.",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "@eslint-community/eslint-utils": "^4.2.0",
         "@eslint-community/regexpp": "^4.6.1",
@@ -2731,6 +2946,23 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/foreground-child": {
+      "version": "3.3.1",
+      "resolved": "https://registry.npmjs.org/foreground-child/-/foreground-child-3.3.1.tgz",
+      "integrity": "sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "cross-spawn": "^7.0.6",
+        "signal-exit": "^4.0.1"
+      },
+      "engines": {
+        "node": ">=14"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/form-data": {
       "version": "4.0.5",
       "resolved": "https://registry.npmjs.org/form-data/-/form-data-4.0.5.tgz",
@@ -3029,6 +3261,13 @@
         "node": ">= 0.4"
       }
     },
+    "node_modules/html-escaper": {
+      "version": "2.0.2",
+      "resolved": "https://registry.npmjs.org/html-escaper/-/html-escaper-2.0.2.tgz",
+      "integrity": "sha512-H2iMtd0I4Mt5eYiapRdIDjp+XzelXQ0tFE4JS7YFwFevXXMmOp9myNrUvCg0D6ws8iqkRPBfKHgbwig1SmlLfg==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/http-errors": {
       "version": "2.0.1",
       "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
@@ -3161,6 +3400,16 @@
         "node": ">=0.10.0"
       }
     },
+    "node_modules/is-fullwidth-code-point": {
+      "version": "3.0.0",
+      "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
+      "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=8"
+      }
+    },
     "node_modules/is-glob": {
       "version": "4.0.3",
       "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
@@ -3201,6 +3450,76 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/istanbul-lib-coverage": {
+      "version": "3.2.2",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-coverage/-/istanbul-lib-coverage-3.2.2.tgz",
+      "integrity": "sha512-O8dpsF+r0WV/8MNRKfnmrtCWhuKjxrq2w+jpzBL5UZKTi2LeVWnWOmWRxFlesJONmc+wLAGvKQZEOanko0LFTg==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/istanbul-lib-report": {
+      "version": "3.0.1",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-report/-/istanbul-lib-report-3.0.1.tgz",
+      "integrity": "sha512-GCfE1mtsHGOELCU8e/Z7YWzpmybrx/+dSTfLrvY8qRmaY6zXTKWn6WQIjaAFw069icm6GVMNkgu0NzI4iPZUNw==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "istanbul-lib-coverage": "^3.0.0",
+        "make-dir": "^4.0.0",
+        "supports-color": "^7.1.0"
+      },
+      "engines": {
+        "node": ">=10"
+      }
+    },
+    "node_modules/istanbul-lib-source-maps": {
+      "version": "5.0.6",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-source-maps/-/istanbul-lib-source-maps-5.0.6.tgz",
+      "integrity": "sha512-yg2d+Em4KizZC5niWhQaIomgf5WlL4vOOjZ5xGCmF8SnPE/mDWWXgvRExdcpCgh9lLRRa1/fSYp2ymmbJ1pI+A==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "@jridgewell/trace-mapping": "^0.3.23",
+        "debug": "^4.1.1",
+        "istanbul-lib-coverage": "^3.0.0"
+      },
+      "engines": {
+        "node": ">=10"
+      }
+    },
+    "node_modules/istanbul-reports": {
+      "version": "3.2.0",
+      "resolved": "https://registry.npmjs.org/istanbul-reports/-/istanbul-reports-3.2.0.tgz",
+      "integrity": "sha512-HGYWWS/ehqTV3xN10i23tkPkpH46MLCIMFNCaaKNavAXTF1RkqxawEPtnjnGZ6XKSInBKkiOA5BKS+aZiY3AvA==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "html-escaper": "^2.0.0",
+        "istanbul-lib-report": "^3.0.0"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/jackspeak": {
+      "version": "3.4.3",
+      "resolved": "https://registry.npmjs.org/jackspeak/-/jackspeak-3.4.3.tgz",
+      "integrity": "sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==",
+      "dev": true,
+      "license": "BlueOak-1.0.0",
+      "dependencies": {
+        "@isaacs/cliui": "^8.0.2"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      },
+      "optionalDependencies": {
+        "@pkgjs/parseargs": "^0.11.0"
+      }
+    },
     "node_modules/js-yaml": {
       "version": "4.1.1",
       "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.1.tgz",
@@ -3374,6 +3693,13 @@
       "dev": true,
       "license": "MIT"
     },
+    "node_modules/lru-cache": {
+      "version": "10.4.3",
+      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-10.4.3.tgz",
+      "integrity": "sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==",
+      "dev": true,
+      "license": "ISC"
+    },
     "node_modules/magic-string": {
       "version": "0.30.21",
       "resolved": "https://registry.npmjs.org/magic-string/-/magic-string-0.30.21.tgz",
@@ -3384,6 +3710,34 @@
         "@jridgewell/sourcemap-codec": "^1.5.5"
       }
     },
+    "node_modules/magicast": {
+      "version": "0.3.5",
+      "resolved": "https://registry.npmjs.org/magicast/-/magicast-0.3.5.tgz",
+      "integrity": "sha512-L0WhttDl+2BOsybvEOLK7fW3UA0OQ0IQ2d6Zl2x/a6vVRs3bAY0ECOSHHeL5jD+SbOpOCUEi0y1DgHEn9Qn1AQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/parser": "^7.25.4",
+        "@babel/types": "^7.25.4",
+        "source-map-js": "^1.2.0"
+      }
+    },
+    "node_modules/make-dir": {
+      "version": "4.0.0",
+      "resolved": "https://registry.npmjs.org/make-dir/-/make-dir-4.0.0.tgz",
+      "integrity": "sha512-hXdUTZYIVOt1Ex//jAQi+wTZZpUpwBj/0QsOzqegb3rGMMeJiSEu5xLHnYfBrRV4RH2+OCSOO95Is/7x1WJ4bw==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "semver": "^7.5.3"
+      },
+      "engines": {
+        "node": ">=10"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/sindresorhus"
+      }
+    },
     "node_modules/math-intrinsics": {
       "version": "1.1.0",
       "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
@@ -3514,6 +3868,16 @@
         "url": "https://github.com/sponsors/ljharb"
       }
     },
+    "node_modules/minipass": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
+      "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
+      "dev": true,
+      "license": "ISC",
+      "engines": {
+        "node": ">=16 || 14 >=14.17"
+      }
+    },
     "node_modules/mkdirp-classic": {
       "version": "0.5.3",
       "resolved": "https://registry.npmjs.org/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz",
@@ -3662,6 +4026,13 @@
         "url": "https://github.com/sponsors/sindresorhus"
       }
     },
+    "node_modules/package-json-from-dist": {
+      "version": "1.0.1",
+      "resolved": "https://registry.npmjs.org/package-json-from-dist/-/package-json-from-dist-1.0.1.tgz",
+      "integrity": "sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==",
+      "dev": true,
+      "license": "BlueOak-1.0.0"
+    },
     "node_modules/parent-module": {
       "version": "1.0.1",
       "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
@@ -3714,6 +4085,23 @@
         "node": ">=8"
       }
     },
+    "node_modules/path-scurry": {
+      "version": "1.11.1",
+      "resolved": "https://registry.npmjs.org/path-scurry/-/path-scurry-1.11.1.tgz",
+      "integrity": "sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==",
+      "dev": true,
+      "license": "BlueOak-1.0.0",
+      "dependencies": {
+        "lru-cache": "^10.2.0",
+        "minipass": "^5.0.0 || ^6.0.2 || ^7.0.0"
+      },
+      "engines": {
+        "node": ">=16 || 14 >=14.18"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/path-to-regexp": {
       "version": "0.1.12",
       "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-0.1.12.tgz",
@@ -4270,6 +4658,19 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/signal-exit": {
+      "version": "4.1.0",
+      "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
+      "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
+      "dev": true,
+      "license": "ISC",
+      "engines": {
+        "node": ">=14"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/simple-concat": {
       "version": "1.0.1",
       "resolved": "https://registry.npmjs.org/simple-concat/-/simple-concat-1.0.1.tgz",
@@ -4367,6 +4768,76 @@
         "safe-buffer": "~5.2.0"
       }
     },
+    "node_modules/string-width": {
+      "version": "5.1.2",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-5.1.2.tgz",
+      "integrity": "sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "eastasianwidth": "^0.2.0",
+        "emoji-regex": "^9.2.2",
+        "strip-ansi": "^7.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/sindresorhus"
+      }
+    },
+    "node_modules/string-width-cjs": {
+      "name": "string-width",
+      "version": "4.2.3",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
+      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "emoji-regex": "^8.0.0",
+        "is-fullwidth-code-point": "^3.0.0",
+        "strip-ansi": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/string-width-cjs/node_modules/emoji-regex": {
+      "version": "8.0.0",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
+      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
+      "dev": true,
+      "license": "MIT"
+    },
+    "node_modules/string-width/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/string-width/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
     "node_modules/strip-ansi": {
       "version": "6.0.1",
       "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
@@ -4380,6 +4851,20 @@
         "node": ">=8"
       }
     },
+    "node_modules/strip-ansi-cjs": {
+      "name": "strip-ansi",
+      "version": "6.0.1",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
+      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^5.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
     "node_modules/strip-json-comments": {
       "version": "3.1.1",
       "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
@@ -4493,6 +4978,43 @@
         "node": ">=6"
       }
     },
+    "node_modules/test-exclude": {
+      "version": "7.0.1",
+      "resolved": "https://registry.npmjs.org/test-exclude/-/test-exclude-7.0.1.tgz",
+      "integrity": "sha512-pFYqmTw68LXVjeWJMST4+borgQP2AyMNbg1BpZh9LbyhUeNkeaPF9gzfPGUAnSMV3qPYdWUwDIjjCLiSDOl7vg==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "@istanbuljs/schema": "^0.1.2",
+        "glob": "^10.4.1",
+        "minimatch": "^9.0.4"
+      },
+      "engines": {
+        "node": ">=18"
+      }
+    },
+    "node_modules/test-exclude/node_modules/glob": {
+      "version": "10.5.0",
+      "resolved": "https://registry.npmjs.org/glob/-/glob-10.5.0.tgz",
+      "integrity": "sha512-DfXN8DfhJ7NH3Oe7cFmu3NCu1wKbkReJ8TorzSAFbSKrlNaQSKfIzqYqVY8zlbs2NLBbWpRiU52GX2PbaBVNkg==",
+      "deprecated": "Old versions of glob are not supported, and contain widely publicized security vulnerabilities, which have been fixed in the current version. Please update. Support for old versions may be purchased (at exorbitant rates) by contacting i@izs.me",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "foreground-child": "^3.1.0",
+        "jackspeak": "^3.1.2",
+        "minimatch": "^9.0.4",
+        "minipass": "^7.1.2",
+        "package-json-from-dist": "^1.0.0",
+        "path-scurry": "^1.11.1"
+      },
+      "bin": {
+        "glob": "dist/esm/bin.mjs"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/text-table": {
       "version": "0.2.0",
       "resolved": "https://registry.npmjs.org/text-table/-/text-table-0.2.0.tgz",
@@ -4636,7 +5158,6 @@
       "integrity": "sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==",
       "dev": true,
       "license": "Apache-2.0",
-      "peer": true,
       "bin": {
         "tsc": "bin/tsc",
         "tsserver": "bin/tsserver"
@@ -4900,6 +5421,107 @@
         "node": ">=0.10.0"
       }
     },
+    "node_modules/wrap-ansi": {
+      "version": "8.1.0",
+      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-8.1.0.tgz",
+      "integrity": "sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-styles": "^6.1.0",
+        "string-width": "^5.0.1",
+        "strip-ansi": "^7.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi-cjs": {
+      "name": "wrap-ansi",
+      "version": "7.0.0",
+      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
+      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-styles": "^4.0.0",
+        "string-width": "^4.1.0",
+        "strip-ansi": "^6.0.0"
+      },
+      "engines": {
+        "node": ">=10"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi-cjs/node_modules/emoji-regex": {
+      "version": "8.0.0",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
+      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
+      "dev": true,
+      "license": "MIT"
+    },
+    "node_modules/wrap-ansi-cjs/node_modules/string-width": {
+      "version": "4.2.3",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
+      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "emoji-regex": "^8.0.0",
+        "is-fullwidth-code-point": "^3.0.0",
+        "strip-ansi": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/ansi-styles": {
+      "version": "6.2.3",
+      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-6.2.3.tgz",
+      "integrity": "sha512-4Dj6M28JB+oAH8kFkTLUo+a2jwOFkuqb3yucU0CANcRRUbxS0cP0nZYCGjcc3BNXwRIsUVmDGgzawme7zvJHvg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
     "node_modules/wrappy": {
       "version": "1.0.2",
       "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
diff --git a/src/app.ts b/src/app.ts
new file mode 100644
index 0000000..4cfc8c1
--- /dev/null
+++ b/src/app.ts
@@ -0,0 +1,33 @@
+import express from "express";
+import { initializeDatabase } from "./db.js";
+import { authMiddleware } from "./middleware.js";
+import { createAuthRouter } from "./routes/auth.js";
+import { createUsersRouter } from "./routes/users.js";
+import { createEventsRouter } from "./routes/events.js";
+import { createQueriesRouter } from "./routes/queries.js";
+import { createDashboardsRouter } from "./routes/dashboards.js";
+import { createExportRouter } from "./routes/export.js";
+// Side-effect import to ensure global type augmentation is included
+import "./types.js";
+
+export function createApp(dbPath?: string): express.Express {
+  const app = express();
+  const db = initializeDatabase(dbPath);
+  const jwtSecret = process.env.JWT_SECRET || "analytics-dashboard-secret";
+
+  app.use(express.json());
+
+  const auth = authMiddleware(jwtSecret);
+
+  // Public routes
+  app.use("/auth", createAuthRouter(db, jwtSecret));
+
+  // Protected routes
+  app.use("/users", auth, createUsersRouter(db));
+  app.use("/events", auth, createEventsRouter(db));
+  app.use("/queries", auth, createQueriesRouter(db));
+  app.use("/dashboards", auth, createDashboardsRouter(db));
+  app.use("/export", auth, createExportRouter(db));
+
+  return app;
+}
diff --git a/src/db.ts b/src/db.ts
new file mode 100644
index 0000000..a8dd1ec
--- /dev/null
+++ b/src/db.ts
@@ -0,0 +1,59 @@
+import Database from "better-sqlite3";
+
+const SCHEMA = `
+CREATE TABLE IF NOT EXISTS users (
+  id TEXT PRIMARY KEY,
+  email TEXT NOT NULL UNIQUE,
+  password_hash TEXT NOT NULL,
+  tenant_id TEXT NOT NULL,
+  role TEXT NOT NULL DEFAULT 'viewer' CHECK(role IN ('admin', 'viewer', 'editor')),
+  created_at TEXT NOT NULL DEFAULT (datetime('now'))
+);
+
+CREATE TABLE IF NOT EXISTS events (
+  id TEXT PRIMARY KEY,
+  tenant_id TEXT NOT NULL,
+  name TEXT NOT NULL,
+  properties TEXT NOT NULL DEFAULT '{}',
+  timestamp TEXT NOT NULL DEFAULT (datetime('now')),
+  user_id TEXT,
+  session_id TEXT
+);
+
+CREATE TABLE IF NOT EXISTS dashboards (
+  id TEXT PRIMARY KEY,
+  tenant_id TEXT NOT NULL,
+  name TEXT NOT NULL,
+  owner_id TEXT NOT NULL,
+  config TEXT NOT NULL DEFAULT '{}',
+  created_at TEXT NOT NULL DEFAULT (datetime('now')),
+  updated_at TEXT NOT NULL DEFAULT (datetime('now')),
+  FOREIGN KEY (owner_id) REFERENCES users(id)
+);
+
+CREATE TABLE IF NOT EXISTS widgets (
+  id TEXT PRIMARY KEY,
+  dashboard_id TEXT NOT NULL,
+  type TEXT NOT NULL CHECK(type IN ('counter', 'timeseries', 'breakdown', 'funnel')),
+  config TEXT NOT NULL DEFAULT '{}',
+  position_x INTEGER NOT NULL DEFAULT 0,
+  position_y INTEGER NOT NULL DEFAULT 0,
+  width INTEGER NOT NULL DEFAULT 1,
+  height INTEGER NOT NULL DEFAULT 1,
+  FOREIGN KEY (dashboard_id) REFERENCES dashboards(id) ON DELETE CASCADE
+);
+
+CREATE INDEX IF NOT EXISTS idx_events_tenant ON events(tenant_id);
+CREATE INDEX IF NOT EXISTS idx_events_name ON events(name);
+CREATE INDEX IF NOT EXISTS idx_events_timestamp ON events(timestamp);
+CREATE INDEX IF NOT EXISTS idx_dashboards_tenant ON dashboards(tenant_id);
+CREATE INDEX IF NOT EXISTS idx_users_tenant ON users(tenant_id);
+`;
+
+export function initializeDatabase(dbPath?: string): Database.Database {
+  const db = new Database(dbPath || ":memory:");
+  db.pragma("journal_mode = WAL");
+  db.pragma("foreign_keys = ON");
+  db.exec(SCHEMA);
+  return db;
+}
diff --git a/src/middleware.ts b/src/middleware.ts
new file mode 100644
index 0000000..0ef4548
--- /dev/null
+++ b/src/middleware.ts
@@ -0,0 +1,29 @@
+import { Request, Response, NextFunction } from "express";
+import jwt from "jsonwebtoken";
+
+export function authMiddleware(secret: string) {
+  return (req: Request, res: Response, next: NextFunction): void => {
+    const header = req.headers.authorization;
+    if (!header || !header.startsWith("Bearer ")) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+    const token = header.substring(7);
+    try {
+      const decoded = jwt.verify(token, secret);
+      if (typeof decoded === "string") {
+        res.status(401).json({ error: "Invalid token format" });
+        return;
+      }
+      req.user = {
+        userId: decoded.userId as string,
+        email: decoded.email as string,
+        tenantId: decoded.tenantId as string,
+        role: decoded.role as string,
+      };
+      next();
+    } catch {
+      res.status(401).json({ error: "Invalid or expired token" });
+    }
+  };
+}
diff --git a/src/routes/auth.ts b/src/routes/auth.ts
new file mode 100644
index 0000000..3bff542
--- /dev/null
+++ b/src/routes/auth.ts
@@ -0,0 +1,124 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+import jwt from "jsonwebtoken";
+import crypto from "crypto";
+import { v4 as uuidv4 } from "uuid";
+import type { UserRow } from "../types.js";
+
+function hashPassword(password: string): string {
+  const salt = crypto.randomBytes(16).toString("hex");
+  const hash = crypto.scryptSync(password, salt, 64).toString("hex");
+  return `${salt}:${hash}`;
+}
+
+function verifyPassword(password: string, stored: string): boolean {
+  const [salt, hash] = stored.split(":");
+  const computed = crypto.scryptSync(password, salt, 64).toString("hex");
+  return hash === computed;
+}
+
+export function createAuthRouter(
+  db: Database.Database,
+  jwtSecret: string
+): Router {
+  const router = Router();
+
+  router.post("/register", (req: Request, res: Response): void => {
+    const { email, password, tenantId, role } = req.body as {
+      email?: string;
+      password?: string;
+      tenantId?: string;
+      role?: string;
+    };
+
+    if (!email || !password || !tenantId) {
+      res
+        .status(400)
+        .json({ error: "email, password, and tenantId are required" });
+      return;
+    }
+
+    const existing = db
+      .prepare("SELECT id FROM users WHERE email = ?")
+      .get(email) as UserRow | undefined;
+    if (existing) {
+      res.status(409).json({ error: "Email already registered" });
+      return;
+    }
+
+    const id = uuidv4();
+    const passwordHash = hashPassword(password);
+    const validRoles = ["admin", "editor", "viewer"];
+    const userRole = role && validRoles.includes(role) ? role : "viewer";
+
+    db.prepare(
+      "INSERT INTO users (id, email, password_hash, tenant_id, role) VALUES (?, ?, ?, ?, ?)"
+    ).run(id, email, passwordHash, tenantId, userRole);
+
+    const user = db
+      .prepare(
+        "SELECT id, email, tenant_id, role, created_at FROM users WHERE id = ?"
+      )
+      .get(id) as UserRow;
+
+    const token = jwt.sign(
+      { userId: id, email, tenantId, role: userRole },
+      jwtSecret,
+      { expiresIn: "24h" }
+    );
+
+    res.status(201).json({
+      user: {
+        id: user.id,
+        email: user.email,
+        tenantId: user.tenant_id,
+        role: user.role,
+        createdAt: user.created_at,
+      },
+      token,
+    });
+  });
+
+  router.post("/login", (req: Request, res: Response): void => {
+    const { email, password } = req.body as {
+      email?: string;
+      password?: string;
+    };
+
+    if (!email || !password) {
+      res.status(400).json({ error: "email and password are required" });
+      return;
+    }
+
+    const user = db
+      .prepare("SELECT * FROM users WHERE email = ?")
+      .get(email) as UserRow | undefined;
+    if (!user || !verifyPassword(password, user.password_hash)) {
+      res.status(401).json({ error: "Invalid credentials" });
+      return;
+    }
+
+    const token = jwt.sign(
+      {
+        userId: user.id,
+        email: user.email,
+        tenantId: user.tenant_id,
+        role: user.role,
+      },
+      jwtSecret,
+      { expiresIn: "24h" }
+    );
+
+    res.json({
+      user: {
+        id: user.id,
+        email: user.email,
+        tenantId: user.tenant_id,
+        role: user.role,
+      },
+      token,
+    });
+  });
+
+  return router;
+}
diff --git a/src/routes/dashboards.ts b/src/routes/dashboards.ts
new file mode 100644
index 0000000..e67345e
--- /dev/null
+++ b/src/routes/dashboards.ts
@@ -0,0 +1,174 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+import { v4 as uuidv4 } from "uuid";
+import type { DashboardRow, WidgetRow } from "../types.js";
+
+export function createDashboardsRouter(db: Database.Database): Router {
+  const router = Router();
+
+  router.get("/", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const dashboards = db
+      .prepare(
+        "SELECT id, tenant_id, name, owner_id, config, created_at, updated_at FROM dashboards WHERE tenant_id = ? ORDER BY created_at DESC"
+      )
+      .all(authUser.tenantId) as DashboardRow[];
+
+    res.json({
+      dashboards: dashboards.map((d) => ({
+        id: d.id,
+        tenantId: d.tenant_id,
+        name: d.name,
+        ownerId: d.owner_id,
+        config: JSON.parse(d.config),
+        createdAt: d.created_at,
+        updatedAt: d.updated_at,
+      })),
+    });
+  });
+
+  router.post("/", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const { name, config } = req.body as {
+      name?: string;
+      config?: Record<string, unknown>;
+    };
+
+    if (!name) {
+      res.status(400).json({ error: "Dashboard name is required" });
+      return;
+    }
+
+    const id = uuidv4();
+    const configJson = JSON.stringify(config || {});
+    const now = new Date().toISOString();
+
+    db.prepare(
+      "INSERT INTO dashboards (id, tenant_id, name, owner_id, config, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?)"
+    ).run(id, authUser.tenantId, name, authUser.userId, configJson, now, now);
+
+    res.status(201).json({
+      id,
+      tenantId: authUser.tenantId,
+      name,
+      ownerId: authUser.userId,
+      config: config || {},
+      createdAt: now,
+      updatedAt: now,
+    });
+  });
+
+  router.get("/:id", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const dashboard = db
+      .prepare("SELECT * FROM dashboards WHERE id = ? AND tenant_id = ?")
+      .get(req.params.id, authUser.tenantId) as DashboardRow | undefined;
+
+    if (!dashboard) {
+      res.status(404).json({ error: "Dashboard not found" });
+      return;
+    }
+
+    const widgets = db
+      .prepare("SELECT * FROM widgets WHERE dashboard_id = ?")
+      .all(dashboard.id) as WidgetRow[];
+
+    res.json({
+      id: dashboard.id,
+      tenantId: dashboard.tenant_id,
+      name: dashboard.name,
+      ownerId: dashboard.owner_id,
+      config: JSON.parse(dashboard.config),
+      createdAt: dashboard.created_at,
+      updatedAt: dashboard.updated_at,
+      widgets: widgets.map((w) => ({
+        id: w.id,
+        dashboardId: w.dashboard_id,
+        type: w.type,
+        config: JSON.parse(w.config),
+        positionX: w.position_x,
+        positionY: w.position_y,
+        width: w.width,
+        height: w.height,
+      })),
+    });
+  });
+
+  router.put("/:id", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const dashboard = db
+      .prepare("SELECT * FROM dashboards WHERE id = ? AND tenant_id = ?")
+      .get(req.params.id, authUser.tenantId) as DashboardRow | undefined;
+
+    if (!dashboard) {
+      res.status(404).json({ error: "Dashboard not found" });
+      return;
+    }
+
+    const { name, config } = req.body as {
+      name?: string;
+      config?: Record<string, unknown>;
+    };
+
+    const updatedName = name ?? dashboard.name;
+    const updatedConfig =
+      config !== undefined ? JSON.stringify(config) : dashboard.config;
+    const now = new Date().toISOString();
+
+    db.prepare(
+      "UPDATE dashboards SET name = ?, config = ?, updated_at = ? WHERE id = ?"
+    ).run(updatedName, updatedConfig, now, dashboard.id);
+
+    res.json({
+      id: dashboard.id,
+      tenantId: dashboard.tenant_id,
+      name: updatedName,
+      ownerId: dashboard.owner_id,
+      config: JSON.parse(updatedConfig),
+      createdAt: dashboard.created_at,
+      updatedAt: now,
+    });
+  });
+
+  router.delete("/:id", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const dashboard = db
+      .prepare("SELECT id FROM dashboards WHERE id = ? AND tenant_id = ?")
+      .get(req.params.id, authUser.tenantId) as DashboardRow | undefined;
+
+    if (!dashboard) {
+      res.status(404).json({ error: "Dashboard not found" });
+      return;
+    }
+
+    db.prepare("DELETE FROM dashboards WHERE id = ?").run(dashboard.id);
+    res.status(204).send();
+  });
+
+  return router;
+}
diff --git a/src/routes/events.ts b/src/routes/events.ts
new file mode 100644
index 0000000..9b9f623
--- /dev/null
+++ b/src/routes/events.ts
@@ -0,0 +1,104 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+import { v4 as uuidv4 } from "uuid";
+
+interface EventInput {
+  name: string;
+  properties?: Record<string, unknown>;
+  timestamp?: string;
+  sessionId?: string;
+}
+
+export function createEventsRouter(db: Database.Database): Router {
+  const router = Router();
+
+  router.post("/", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const { name, properties, timestamp, sessionId } = req.body as EventInput;
+
+    if (!name) {
+      res.status(400).json({ error: "Event name is required" });
+      return;
+    }
+
+    const id = uuidv4();
+    const eventTimestamp = timestamp || new Date().toISOString();
+    const eventProperties = JSON.stringify(properties || {});
+
+    db.prepare(
+      "INSERT INTO events (id, tenant_id, name, properties, timestamp, user_id, session_id) VALUES (?, ?, ?, ?, ?, ?, ?)"
+    ).run(
+      id,
+      authUser.tenantId,
+      name,
+      eventProperties,
+      eventTimestamp,
+      authUser.userId,
+      sessionId || null
+    );
+
+    res.status(201).json({
+      id,
+      tenantId: authUser.tenantId,
+      name,
+      properties: properties || {},
+      timestamp: eventTimestamp,
+      userId: authUser.userId,
+      sessionId: sessionId || null,
+    });
+  });
+
+  router.post("/batch", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const { events } = req.body as { events?: EventInput[] };
+
+    if (!events || !Array.isArray(events) || events.length === 0) {
+      res.status(400).json({ error: "events array is required and must not be empty" });
+      return;
+    }
+
+    const insert = db.prepare(
+      "INSERT INTO events (id, tenant_id, name, properties, timestamp, user_id, session_id) VALUES (?, ?, ?, ?, ?, ?, ?)"
+    );
+
+    const insertedIds: string[] = [];
+
+    const insertMany = db.transaction((items: EventInput[]) => {
+      for (const event of items) {
+        if (!event.name) continue;
+        const id = uuidv4();
+        const eventTimestamp = event.timestamp || new Date().toISOString();
+        const eventProperties = JSON.stringify(event.properties || {});
+        insert.run(
+          id,
+          authUser.tenantId,
+          event.name,
+          eventProperties,
+          eventTimestamp,
+          authUser.userId,
+          event.sessionId || null
+        );
+        insertedIds.push(id);
+      }
+    });
+
+    insertMany(events);
+
+    res.status(201).json({
+      ingested: insertedIds.length,
+      events: insertedIds.map((id) => ({ id })),
+    });
+  });
+
+  return router;
+}
diff --git a/src/routes/export.ts b/src/routes/export.ts
new file mode 100644
index 0000000..663d143
--- /dev/null
+++ b/src/routes/export.ts
@@ -0,0 +1,119 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+import type { EventRow, DashboardRow } from "../types.js";
+
+function eventsToCsv(events: EventRow[]): string {
+  const header = "id,tenant_id,name,properties,timestamp,user_id,session_id";
+  const rows = events.map((e) => {
+    const props = e.properties.replace(/"/g, '""');
+    const userId = e.user_id ?? "";
+    const sessionId = e.session_id ?? "";
+    return `${e.id},${e.tenant_id},${e.name},"${props}",${e.timestamp},${userId},${sessionId}`;
+  });
+  return [header, ...rows].join("\n");
+}
+
+export function createExportRouter(db: Database.Database): Router {
+  const router = Router();
+
+  router.get("/events", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const format = (req.query.format as string) || "json";
+    const eventName = req.query.event as string | undefined;
+    const startDate = req.query.startDate as string | undefined;
+    const endDate = req.query.endDate as string | undefined;
+
+    const conditions: string[] = ["tenant_id = ?"];
+    const params: string[] = [authUser.tenantId];
+
+    if (eventName) {
+      conditions.push("name = ?");
+      params.push(eventName);
+    }
+    if (startDate) {
+      conditions.push("timestamp >= ?");
+      params.push(startDate);
+    }
+    if (endDate) {
+      conditions.push("timestamp <= ?");
+      params.push(endDate);
+    }
+
+    const events = db
+      .prepare(
+        `SELECT * FROM events WHERE ${conditions.join(" AND ")} ORDER BY timestamp DESC`
+      )
+      .all(...params) as EventRow[];
+
+    if (format === "csv") {
+      res.setHeader("Content-Type", "text/csv");
+      res.setHeader(
+        "Content-Disposition",
+        "attachment; filename=events.csv"
+      );
+      res.send(eventsToCsv(events));
+    } else {
+      res.json({
+        events: events.map((e) => ({
+          id: e.id,
+          tenantId: e.tenant_id,
+          name: e.name,
+          properties: JSON.parse(e.properties),
+          timestamp: e.timestamp,
+          userId: e.user_id,
+          sessionId: e.session_id,
+        })),
+      });
+    }
+  });
+
+  router.get("/dashboards/:id", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const format = (req.query.format as string) || "json";
+
+    const dashboard = db
+      .prepare("SELECT * FROM dashboards WHERE id = ? AND tenant_id = ?")
+      .get(req.params.id, authUser.tenantId) as DashboardRow | undefined;
+
+    if (!dashboard) {
+      res.status(404).json({ error: "Dashboard not found" });
+      return;
+    }
+
+    const dashboardData = {
+      id: dashboard.id,
+      tenantId: dashboard.tenant_id,
+      name: dashboard.name,
+      ownerId: dashboard.owner_id,
+      config: JSON.parse(dashboard.config),
+      createdAt: dashboard.created_at,
+      updatedAt: dashboard.updated_at,
+    };
+
+    if (format === "csv") {
+      const header = "id,tenant_id,name,owner_id,config,created_at,updated_at";
+      const configStr = dashboard.config.replace(/"/g, '""');
+      const row = `${dashboard.id},${dashboard.tenant_id},${dashboard.name},${dashboard.owner_id},"${configStr}",${dashboard.created_at},${dashboard.updated_at}`;
+      res.setHeader("Content-Type", "text/csv");
+      res.setHeader(
+        "Content-Disposition",
+        "attachment; filename=dashboard.csv"
+      );
+      res.send(`${header}\n${row}`);
+    } else {
+      res.json(dashboardData);
+    }
+  });
+
+  return router;
+}
diff --git a/src/routes/queries.ts b/src/routes/queries.ts
new file mode 100644
index 0000000..13bf344
--- /dev/null
+++ b/src/routes/queries.ts
@@ -0,0 +1,138 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+
+interface QueryFilter {
+  event?: string;
+  startDate?: string;
+  endDate?: string;
+  filters?: Record<string, string>;
+}
+
+function buildWhereClause(
+  tenantId: string,
+  filter: QueryFilter
+): { clause: string; params: (string | number)[] } {
+  const conditions: string[] = ["tenant_id = ?"];
+  const params: (string | number)[] = [tenantId];
+
+  if (filter.event) {
+    conditions.push("name = ?");
+    params.push(filter.event);
+  }
+
+  if (filter.startDate) {
+    conditions.push("timestamp >= ?");
+    params.push(filter.startDate);
+  }
+
+  if (filter.endDate) {
+    conditions.push("timestamp <= ?");
+    params.push(filter.endDate);
+  }
+
+  if (filter.filters) {
+    for (const [key, value] of Object.entries(filter.filters)) {
+      conditions.push("json_extract(properties, ?) = ?");
+      params.push(`$.${key}`, value);
+    }
+  }
+
+  return { clause: conditions.join(" AND "), params };
+}
+
+export function createQueriesRouter(db: Database.Database): Router {
+  const router = Router();
+
+  router.post("/count", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const filter = req.body as QueryFilter;
+    const { clause, params } = buildWhereClause(authUser.tenantId, filter);
+
+    const row = db
+      .prepare(`SELECT COUNT(*) as count FROM events WHERE ${clause}`)
+      .get(...params) as { count: number };
+
+    res.json({ count: row.count });
+  });
+
+  router.post("/timeseries", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const { interval, ...filter } = req.body as QueryFilter & {
+      interval?: string;
+    };
+    const { clause, params } = buildWhereClause(authUser.tenantId, filter);
+
+    let bucketExpr: string;
+    switch (interval) {
+      case "hour":
+        bucketExpr = "strftime('%Y-%m-%d %H:00:00', timestamp)";
+        break;
+      case "week":
+        bucketExpr = "strftime('%Y-W%W', timestamp)";
+        break;
+      case "month":
+        bucketExpr = "strftime('%Y-%m', timestamp)";
+        break;
+      default:
+        bucketExpr = "date(timestamp)";
+        break;
+    }
+
+    const rows = db
+      .prepare(
+        `SELECT ${bucketExpr} as bucket, COUNT(*) as count FROM events WHERE ${clause} GROUP BY bucket ORDER BY bucket`
+      )
+      .all(...params) as { bucket: string; count: number }[];
+
+    res.json({ timeseries: rows });
+  });
+
+  router.post("/breakdown", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const { property, ...filter } = req.body as QueryFilter & {
+      property?: string;
+    };
+
+    if (!property) {
+      res
+        .status(400)
+        .json({ error: "property field is required for breakdown queries" });
+      return;
+    }
+
+    const { clause, params } = buildWhereClause(authUser.tenantId, filter);
+
+    const rows = db
+      .prepare(
+        `SELECT json_extract(properties, ?) as value, COUNT(*) as count FROM events WHERE ${clause} GROUP BY value ORDER BY count DESC`
+      )
+      .all(`$.${property}`, ...params) as {
+      value: string | null;
+      count: number;
+    }[];
+
+    res.json({
+      breakdown: rows.map((r) => ({
+        value: r.value ?? "(none)",
+        count: r.count,
+      })),
+    });
+  });
+
+  return router;
+}
diff --git a/src/routes/users.ts b/src/routes/users.ts
new file mode 100644
index 0000000..68c71fb
--- /dev/null
+++ b/src/routes/users.ts
@@ -0,0 +1,89 @@
+import { Router, Request, Response } from "express";
+import type Database from "better-sqlite3";
+import type { UserRow } from "../types.js";
+
+export function createUsersRouter(db: Database.Database): Router {
+  const router = Router();
+
+  router.get("/me", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    const user = db
+      .prepare(
+        "SELECT id, email, tenant_id, role, created_at FROM users WHERE id = ?"
+      )
+      .get(authUser.userId) as UserRow | undefined;
+
+    if (!user) {
+      res.status(404).json({ error: "User not found" });
+      return;
+    }
+
+    res.json({
+      id: user.id,
+      email: user.email,
+      tenantId: user.tenant_id,
+      role: user.role,
+      createdAt: user.created_at,
+    });
+  });
+
+  router.put("/:userId/role", (req: Request, res: Response): void => {
+    const authUser = req.user;
+    if (!authUser) {
+      res.status(401).json({ error: "Authentication required" });
+      return;
+    }
+
+    if (authUser.role !== "admin") {
+      res.status(403).json({ error: "Only admins can change user roles" });
+      return;
+    }
+
+    const { userId } = req.params;
+    const { role } = req.body as { role?: string };
+
+    if (!role || !["admin", "editor", "viewer"].includes(role)) {
+      res.status(400).json({ error: "Valid role is required (admin, editor, viewer)" });
+      return;
+    }
+
+    const targetUser = db
+      .prepare("SELECT id, tenant_id FROM users WHERE id = ?")
+      .get(userId) as UserRow | undefined;
+
+    if (!targetUser) {
+      res.status(404).json({ error: "User not found" });
+      return;
+    }
+
+    if (targetUser.tenant_id !== authUser.tenantId) {
+      res
+        .status(403)
+        .json({ error: "Cannot modify users outside your tenant" });
+      return;
+    }
+
+    db.prepare("UPDATE users SET role = ? WHERE id = ?").run(role, userId);
+
+    const updated = db
+      .prepare(
+        "SELECT id, email, tenant_id, role, created_at FROM users WHERE id = ?"
+      )
+      .get(userId) as UserRow;
+
+    res.json({
+      id: updated.id,
+      email: updated.email,
+      tenantId: updated.tenant_id,
+      role: updated.role,
+      createdAt: updated.created_at,
+    });
+  });
+
+  return router;
+}
diff --git a/src/types.ts b/src/types.ts
new file mode 100644
index 0000000..fc77290
--- /dev/null
+++ b/src/types.ts
@@ -0,0 +1,55 @@
+export interface AuthUser {
+  userId: string;
+  email: string;
+  tenantId: string;
+  role: string;
+}
+
+export interface UserRow {
+  id: string;
+  email: string;
+  password_hash: string;
+  tenant_id: string;
+  role: string;
+  created_at: string;
+}
+
+export interface EventRow {
+  id: string;
+  tenant_id: string;
+  name: string;
+  properties: string;
+  timestamp: string;
+  user_id: string | null;
+  session_id: string | null;
+}
+
+export interface DashboardRow {
+  id: string;
+  tenant_id: string;
+  name: string;
+  owner_id: string;
+  config: string;
+  created_at: string;
+  updated_at: string;
+}
+
+export interface WidgetRow {
+  id: string;
+  dashboard_id: string;
+  type: string;
+  config: string;
+  position_x: number;
+  position_y: number;
+  width: number;
+  height: number;
+}
+
+declare global {
+  // eslint-disable-next-line @typescript-eslint/no-namespace
+  namespace Express {
+    interface Request {
+      user?: AuthUser;
+    }
+  }
+}
diff --git a/tests/integration.test.ts b/tests/integration.test.ts
new file mode 100644
index 0000000..4798e4c
--- /dev/null
+++ b/tests/integration.test.ts
@@ -0,0 +1,619 @@
+import { describe, it, expect, beforeEach } from "vitest";
+import request from "supertest";
+import { createApp } from "../src/app.js";
+import type { Express } from "express";
+
+let app: Express;
+
+beforeEach(() => {
+  app = createApp(":memory:");
+});
+
+// Helper: register and return token
+async function registerUser(
+  overrides: Record<string, string> = {}
+): Promise<{ token: string; user: Record<string, string> }> {
+  const defaults = {
+    email: `user-${Date.now()}-${Math.random()}@test.com`,
+    password: "password123",
+    tenantId: "tenant-1",
+    role: "admin",
+  };
+  const body = { ...defaults, ...overrides };
+  const res = await request(app).post("/auth/register").send(body);
+  return { token: res.body.token, user: res.body.user };
+}
+
+describe("Auth", () => {
+  it("should register a new user", async () => {
+    const res = await request(app).post("/auth/register").send({
+      email: "test@example.com",
+      password: "password123",
+      tenantId: "tenant-1",
+    });
+    expect(res.status).toBe(201);
+    expect(res.body.token).toBeDefined();
+    expect(res.body.user.email).toBe("test@example.com");
+    expect(res.body.user.tenantId).toBe("tenant-1");
+    expect(res.body.user.role).toBe("viewer");
+  });
+
+  it("should register with a specific role", async () => {
+    const res = await request(app).post("/auth/register").send({
+      email: "admin@example.com",
+      password: "password123",
+      tenantId: "tenant-1",
+      role: "admin",
+    });
+    expect(res.status).toBe(201);
+    expect(res.body.user.role).toBe("admin");
+  });
+
+  it("should reject duplicate email", async () => {
+    await request(app).post("/auth/register").send({
+      email: "dup@example.com",
+      password: "pass",
+      tenantId: "t1",
+    });
+    const res = await request(app).post("/auth/register").send({
+      email: "dup@example.com",
+      password: "pass",
+      tenantId: "t1",
+    });
+    expect(res.status).toBe(409);
+  });
+
+  it("should reject registration with missing fields", async () => {
+    const res = await request(app)
+      .post("/auth/register")
+      .send({ email: "x@y.com" });
+    expect(res.status).toBe(400);
+  });
+
+  it("should login with valid credentials", async () => {
+    await request(app).post("/auth/register").send({
+      email: "login@example.com",
+      password: "mypass",
+      tenantId: "tenant-1",
+    });
+    const res = await request(app).post("/auth/login").send({
+      email: "login@example.com",
+      password: "mypass",
+    });
+    expect(res.status).toBe(200);
+    expect(res.body.token).toBeDefined();
+    expect(res.body.user.email).toBe("login@example.com");
+  });
+
+  it("should reject login with wrong password", async () => {
+    await request(app).post("/auth/register").send({
+      email: "wrong@example.com",
+      password: "correct",
+      tenantId: "t1",
+    });
+    const res = await request(app).post("/auth/login").send({
+      email: "wrong@example.com",
+      password: "incorrect",
+    });
+    expect(res.status).toBe(401);
+  });
+
+  it("should reject login with non-existent user", async () => {
+    const res = await request(app).post("/auth/login").send({
+      email: "ghost@example.com",
+      password: "pass",
+    });
+    expect(res.status).toBe(401);
+  });
+});
+
+describe("Protected routes require auth", () => {
+  it("should return 401 for /users/me without token", async () => {
+    const res = await request(app).get("/users/me");
+    expect(res.status).toBe(401);
+  });
+
+  it("should return 401 for /events without token", async () => {
+    const res = await request(app).post("/events").send({ name: "test" });
+    expect(res.status).toBe(401);
+  });
+
+  it("should return 401 for /dashboards without token", async () => {
+    const res = await request(app).get("/dashboards");
+    expect(res.status).toBe(401);
+  });
+
+  it("should return 401 for /queries/count without token", async () => {
+    const res = await request(app).post("/queries/count").send({});
+    expect(res.status).toBe(401);
+  });
+
+  it("should return 401 for /export/events without token", async () => {
+    const res = await request(app).get("/export/events");
+    expect(res.status).toBe(401);
+  });
+
+  it("should return 401 with invalid token", async () => {
+    const res = await request(app)
+      .get("/users/me")
+      .set("Authorization", "Bearer invalidtoken");
+    expect(res.status).toBe(401);
+  });
+});
+
+describe("Users", () => {
+  it("should return current user profile", async () => {
+    const { token } = await registerUser({ email: "me@test.com" });
+    const res = await request(app)
+      .get("/users/me")
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.body.email).toBe("me@test.com");
+    expect(res.body.tenantId).toBe("tenant-1");
+  });
+
+  it("should allow admin to change user role", async () => {
+    const { token: adminToken } = await registerUser({
+      email: "admin@test.com",
+      role: "admin",
+    });
+    const { user: viewer } = await registerUser({
+      email: "viewer@test.com",
+      role: "viewer",
+    });
+
+    const res = await request(app)
+      .put(`/users/${viewer.id}/role`)
+      .set("Authorization", `Bearer ${adminToken}`)
+      .send({ role: "editor" });
+    expect(res.status).toBe(200);
+    expect(res.body.role).toBe("editor");
+  });
+
+  it("should reject non-admin changing roles", async () => {
+    const { token: viewerToken } = await registerUser({
+      email: "v@test.com",
+      role: "viewer",
+    });
+    const { user: other } = await registerUser({ email: "o@test.com" });
+
+    const res = await request(app)
+      .put(`/users/${other.id}/role`)
+      .set("Authorization", `Bearer ${viewerToken}`)
+      .send({ role: "admin" });
+    expect(res.status).toBe(403);
+  });
+
+  it("should reject admin changing user in different tenant", async () => {
+    const { token: adminToken } = await registerUser({
+      email: "a@t1.com",
+      role: "admin",
+      tenantId: "tenant-1",
+    });
+    const { user: otherUser } = await registerUser({
+      email: "u@t2.com",
+      tenantId: "tenant-2",
+    });
+
+    const res = await request(app)
+      .put(`/users/${otherUser.id}/role`)
+      .set("Authorization", `Bearer ${adminToken}`)
+      .send({ role: "editor" });
+    expect(res.status).toBe(403);
+  });
+});
+
+describe("Events", () => {
+  it("should ingest a single event", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/events")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "page_view", properties: { url: "/home" } });
+    expect(res.status).toBe(201);
+    expect(res.body.name).toBe("page_view");
+    expect(res.body.properties).toEqual({ url: "/home" });
+    expect(res.body.id).toBeDefined();
+    expect(res.body.tenantId).toBe("tenant-1");
+  });
+
+  it("should ingest batch events", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${token}`)
+      .send({
+        events: [
+          { name: "click", properties: { button: "submit" } },
+          { name: "page_view", properties: { url: "/about" } },
+          { name: "signup" },
+        ],
+      });
+    expect(res.status).toBe(201);
+    expect(res.body.ingested).toBe(3);
+    expect(res.body.events).toHaveLength(3);
+  });
+
+  it("should reject event without name", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/events")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ properties: { x: 1 } });
+    expect(res.status).toBe(400);
+  });
+
+  it("should reject empty batch", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ events: [] });
+    expect(res.status).toBe(400);
+  });
+});
+
+describe("Queries", () => {
+  async function seedEvents(token: string) {
+    await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${token}`)
+      .send({
+        events: [
+          {
+            name: "page_view",
+            properties: { url: "/home" },
+            timestamp: "2024-01-01T10:00:00Z",
+          },
+          {
+            name: "page_view",
+            properties: { url: "/about" },
+            timestamp: "2024-01-01T14:00:00Z",
+          },
+          {
+            name: "page_view",
+            properties: { url: "/home" },
+            timestamp: "2024-01-02T10:00:00Z",
+          },
+          {
+            name: "click",
+            properties: { button: "signup" },
+            timestamp: "2024-01-02T12:00:00Z",
+          },
+          {
+            name: "page_view",
+            properties: { url: "/pricing" },
+            timestamp: "2024-01-03T09:00:00Z",
+          },
+        ],
+      });
+  }
+
+  it("should count all events", async () => {
+    const { token } = await registerUser();
+    await seedEvents(token);
+    const res = await request(app)
+      .post("/queries/count")
+      .set("Authorization", `Bearer ${token}`)
+      .send({});
+    expect(res.status).toBe(200);
+    expect(res.body.count).toBe(5);
+  });
+
+  it("should count events by name", async () => {
+    const { token } = await registerUser();
+    await seedEvents(token);
+    const res = await request(app)
+      .post("/queries/count")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ event: "page_view" });
+    expect(res.status).toBe(200);
+    expect(res.body.count).toBe(4);
+  });
+
+  it("should count events with date range", async () => {
+    const { token } = await registerUser();
+    await seedEvents(token);
+    const res = await request(app)
+      .post("/queries/count")
+      .set("Authorization", `Bearer ${token}`)
+      .send({
+        event: "page_view",
+        startDate: "2024-01-02T00:00:00Z",
+        endDate: "2024-01-02T23:59:59Z",
+      });
+    expect(res.status).toBe(200);
+    expect(res.body.count).toBe(1);
+  });
+
+  it("should return timeseries data", async () => {
+    const { token } = await registerUser();
+    await seedEvents(token);
+    const res = await request(app)
+      .post("/queries/timeseries")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ event: "page_view", interval: "day" });
+    expect(res.status).toBe(200);
+    expect(res.body.timeseries).toBeInstanceOf(Array);
+    expect(res.body.timeseries.length).toBeGreaterThanOrEqual(2);
+    // Each entry should have bucket and count
+    for (const entry of res.body.timeseries) {
+      expect(entry.bucket).toBeDefined();
+      expect(typeof entry.count).toBe("number");
+    }
+  });
+
+  it("should return breakdown data", async () => {
+    const { token } = await registerUser();
+    await seedEvents(token);
+    const res = await request(app)
+      .post("/queries/breakdown")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ event: "page_view", property: "url" });
+    expect(res.status).toBe(200);
+    expect(res.body.breakdown).toBeInstanceOf(Array);
+    // /home should have count 2
+    const homeEntry = res.body.breakdown.find(
+      (b: { value: string }) => b.value === "/home"
+    );
+    expect(homeEntry).toBeDefined();
+    expect(homeEntry.count).toBe(2);
+  });
+
+  it("should reject breakdown without property", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/queries/breakdown")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ event: "page_view" });
+    expect(res.status).toBe(400);
+  });
+
+  it("should enforce tenant isolation in queries", async () => {
+    const { token: t1Token } = await registerUser({
+      email: "t1@test.com",
+      tenantId: "iso-tenant-1",
+    });
+    const { token: t2Token } = await registerUser({
+      email: "t2@test.com",
+      tenantId: "iso-tenant-2",
+    });
+
+    // Seed events for tenant 1
+    await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${t1Token}`)
+      .send({ events: [{ name: "ev" }, { name: "ev" }, { name: "ev" }] });
+
+    // Seed events for tenant 2
+    await request(app)
+      .post("/events")
+      .set("Authorization", `Bearer ${t2Token}`)
+      .send({ name: "ev" });
+
+    // Tenant 1 should see 3
+    const r1 = await request(app)
+      .post("/queries/count")
+      .set("Authorization", `Bearer ${t1Token}`)
+      .send({});
+    expect(r1.body.count).toBe(3);
+
+    // Tenant 2 should see 1
+    const r2 = await request(app)
+      .post("/queries/count")
+      .set("Authorization", `Bearer ${t2Token}`)
+      .send({});
+    expect(r2.body.count).toBe(1);
+  });
+});
+
+describe("Dashboards", () => {
+  it("should create a dashboard", async () => {
+    const { token } = await registerUser();
+    const res = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "My Dashboard", config: { layout: "grid" } });
+    expect(res.status).toBe(201);
+    expect(res.body.name).toBe("My Dashboard");
+    expect(res.body.config).toEqual({ layout: "grid" });
+    expect(res.body.id).toBeDefined();
+  });
+
+  it("should list tenant dashboards", async () => {
+    const { token } = await registerUser();
+    await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "D1" });
+    await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "D2" });
+
+    const res = await request(app)
+      .get("/dashboards")
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.body.dashboards).toHaveLength(2);
+  });
+
+  it("should get a dashboard by id", async () => {
+    const { token } = await registerUser();
+    const created = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "Detail" });
+
+    const res = await request(app)
+      .get(`/dashboards/${created.body.id}`)
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.body.name).toBe("Detail");
+    expect(res.body.widgets).toBeInstanceOf(Array);
+  });
+
+  it("should update a dashboard", async () => {
+    const { token } = await registerUser();
+    const created = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "Old Name" });
+
+    const res = await request(app)
+      .put(`/dashboards/${created.body.id}`)
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "New Name", config: { theme: "dark" } });
+    expect(res.status).toBe(200);
+    expect(res.body.name).toBe("New Name");
+    expect(res.body.config).toEqual({ theme: "dark" });
+  });
+
+  it("should delete a dashboard", async () => {
+    const { token } = await registerUser();
+    const created = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "Deleteme" });
+
+    const delRes = await request(app)
+      .delete(`/dashboards/${created.body.id}`)
+      .set("Authorization", `Bearer ${token}`);
+    expect(delRes.status).toBe(204);
+
+    // Verify it's gone
+    const getRes = await request(app)
+      .get(`/dashboards/${created.body.id}`)
+      .set("Authorization", `Bearer ${token}`);
+    expect(getRes.status).toBe(404);
+  });
+
+  it("should enforce tenant isolation for dashboards", async () => {
+    const { token: t1Token } = await registerUser({
+      email: "d1@test.com",
+      tenantId: "dash-t1",
+    });
+    const { token: t2Token } = await registerUser({
+      email: "d2@test.com",
+      tenantId: "dash-t2",
+    });
+
+    const created = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${t1Token}`)
+      .send({ name: "T1 Dashboard" });
+
+    // Tenant 2 should not see tenant 1's dashboard
+    const getRes = await request(app)
+      .get(`/dashboards/${created.body.id}`)
+      .set("Authorization", `Bearer ${t2Token}`);
+    expect(getRes.status).toBe(404);
+
+    // Tenant 2's list should be empty
+    const listRes = await request(app)
+      .get("/dashboards")
+      .set("Authorization", `Bearer ${t2Token}`);
+    expect(listRes.body.dashboards).toHaveLength(0);
+  });
+});
+
+describe("Export", () => {
+  it("should export events as JSON", async () => {
+    const { token } = await registerUser();
+    await request(app)
+      .post("/events")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "test_event" });
+
+    const res = await request(app)
+      .get("/export/events?format=json")
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.body.events).toBeInstanceOf(Array);
+    expect(res.body.events.length).toBeGreaterThanOrEqual(1);
+  });
+
+  it("should export events as CSV", async () => {
+    const { token } = await registerUser();
+    await request(app)
+      .post("/events")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "csv_event" });
+
+    const res = await request(app)
+      .get("/export/events?format=csv")
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.headers["content-type"]).toContain("text/csv");
+    expect(res.text).toContain("id,tenant_id,name");
+    expect(res.text).toContain("csv_event");
+  });
+
+  it("should export events filtered by name", async () => {
+    const { token } = await registerUser();
+    await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${token}`)
+      .send({
+        events: [{ name: "wanted" }, { name: "unwanted" }, { name: "wanted" }],
+      });
+
+    const res = await request(app)
+      .get("/export/events?format=json&event=wanted")
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.body.events).toHaveLength(2);
+  });
+
+  it("should export dashboard as JSON", async () => {
+    const { token } = await registerUser();
+    const dash = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "Export Test" });
+
+    const res = await request(app)
+      .get(`/export/dashboards/${dash.body.id}?format=json`)
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.body.name).toBe("Export Test");
+  });
+
+  it("should export dashboard as CSV", async () => {
+    const { token } = await registerUser();
+    const dash = await request(app)
+      .post("/dashboards")
+      .set("Authorization", `Bearer ${token}`)
+      .send({ name: "CSV Dash" });
+
+    const res = await request(app)
+      .get(`/export/dashboards/${dash.body.id}?format=csv`)
+      .set("Authorization", `Bearer ${token}`);
+    expect(res.status).toBe(200);
+    expect(res.headers["content-type"]).toContain("text/csv");
+    expect(res.text).toContain("CSV Dash");
+  });
+
+  it("should enforce tenant isolation on export", async () => {
+    const { token: t1Token } = await registerUser({
+      email: "exp1@test.com",
+      tenantId: "exp-t1",
+    });
+    const { token: t2Token } = await registerUser({
+      email: "exp2@test.com",
+      tenantId: "exp-t2",
+    });
+
+    await request(app)
+      .post("/events/batch")
+      .set("Authorization", `Bearer ${t1Token}`)
+      .send({
+        events: [{ name: "secret" }, { name: "secret" }],
+      });
+
+    // Tenant 2 should see no events
+    const res = await request(app)
+      .get("/export/events?format=json")
+      .set("Authorization", `Bearer ${t2Token}`);
+    expect(res.body.events).toHaveLength(0);
+  });
+});
