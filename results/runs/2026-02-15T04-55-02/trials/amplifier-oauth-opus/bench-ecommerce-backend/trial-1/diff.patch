diff --git a/.amplifier/settings.local.yaml b/.amplifier/settings.local.yaml
new file mode 100644
index 0000000..64831cc
--- /dev/null
+++ b/.amplifier/settings.local.yaml
@@ -0,0 +1,11 @@
+config:
+  providers:
+  - config:
+      api_key: ${ANTHROPIC_API_KEY}
+      base_url: https://api.anthropic.com
+      default_model: claude-opus-4-6
+      enable_1m_context: 'true'
+      enable_prompt_caching: 'true'
+      priority: 1
+    module: provider-anthropic
+    source: /opt/amplifier-provider-anthropic
diff --git a/.thunderdome-stderr.log b/.thunderdome-stderr.log
new file mode 100644
index 0000000..fd371b2
--- /dev/null
+++ b/.thunderdome-stderr.log
@@ -0,0 +1,6 @@
+
+[36mðŸ§  Thinking...[0m
+
+[36mðŸ§  Thinking...[0m
+
+[36mðŸ§  Thinking...[0m
diff --git a/package-lock.json b/package-lock.json
index 783de11..1c1962f 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -18,11 +18,83 @@
         "@types/uuid": "^10.0.0",
         "@typescript-eslint/eslint-plugin": "^7.0.0",
         "@typescript-eslint/parser": "^7.0.0",
+        "@vitest/coverage-v8": "^2.0.0",
         "eslint": "^8.56.0",
         "typescript": "^5.4.0",
         "vitest": "^2.0.0"
       }
     },
+    "node_modules/@ampproject/remapping": {
+      "version": "2.3.0",
+      "resolved": "https://registry.npmjs.org/@ampproject/remapping/-/remapping-2.3.0.tgz",
+      "integrity": "sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==",
+      "dev": true,
+      "license": "Apache-2.0",
+      "dependencies": {
+        "@jridgewell/gen-mapping": "^0.3.5",
+        "@jridgewell/trace-mapping": "^0.3.24"
+      },
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
+    "node_modules/@babel/helper-string-parser": {
+      "version": "7.27.1",
+      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
+      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@babel/helper-validator-identifier": {
+      "version": "7.28.5",
+      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",
+      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@babel/parser": {
+      "version": "7.29.0",
+      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.29.0.tgz",
+      "integrity": "sha512-IyDgFV5GeDUVX4YdF/3CPULtVGSXXMLh1xVIgdCgxApktqnQV0r7/8Nqthg+8YLGaAtdyIlo2qIdZrbCv4+7ww==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/types": "^7.29.0"
+      },
+      "bin": {
+        "parser": "bin/babel-parser.js"
+      },
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
+    "node_modules/@babel/types": {
+      "version": "7.29.0",
+      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.29.0.tgz",
+      "integrity": "sha512-LwdZHpScM4Qz8Xw2iKSzS+cfglZzJGvofQICy7W7v4caru4EaAmyUuO6BGrbyQ2mYV11W0U8j5mBhd14dd3B0A==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/helper-string-parser": "^7.27.1",
+        "@babel/helper-validator-identifier": "^7.28.5"
+      },
+      "engines": {
+        "node": ">=6.9.0"
+      }
+    },
+    "node_modules/@bcoe/v8-coverage": {
+      "version": "0.2.3",
+      "resolved": "https://registry.npmjs.org/@bcoe/v8-coverage/-/v8-coverage-0.2.3.tgz",
+      "integrity": "sha512-0hYQ8SB4Db5zvZB4axdMHGwEaQjkZzFjQiN9LVYvIFB2nSUHW9tYpxWriPrWDASIxiaXax83REcLxuSdnGPZtw==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/@esbuild/aix-ppc64": {
       "version": "0.21.5",
       "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.21.5.tgz",
@@ -563,6 +635,84 @@
       "dev": true,
       "license": "BSD-3-Clause"
     },
+    "node_modules/@isaacs/cliui": {
+      "version": "8.0.2",
+      "resolved": "https://registry.npmjs.org/@isaacs/cliui/-/cliui-8.0.2.tgz",
+      "integrity": "sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "string-width": "^5.1.2",
+        "string-width-cjs": "npm:string-width@^4.2.0",
+        "strip-ansi": "^7.0.1",
+        "strip-ansi-cjs": "npm:strip-ansi@^6.0.1",
+        "wrap-ansi": "^8.1.0",
+        "wrap-ansi-cjs": "npm:wrap-ansi@^7.0.0"
+      },
+      "engines": {
+        "node": ">=12"
+      }
+    },
+    "node_modules/@isaacs/cliui/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/@isaacs/cliui/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
+    "node_modules/@istanbuljs/schema": {
+      "version": "0.1.3",
+      "resolved": "https://registry.npmjs.org/@istanbuljs/schema/-/schema-0.1.3.tgz",
+      "integrity": "sha512-ZXRY4jNvVgSVQ8DL3LTcakaAtXwTVUxE81hslsyD2AtoXW/wVob10HkOJ1X/pAlcI7D+2YoZKg5do8G/w6RYgA==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/@jridgewell/gen-mapping": {
+      "version": "0.3.13",
+      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
+      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@jridgewell/sourcemap-codec": "^1.5.0",
+        "@jridgewell/trace-mapping": "^0.3.24"
+      }
+    },
+    "node_modules/@jridgewell/resolve-uri": {
+      "version": "3.1.2",
+      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
+      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=6.0.0"
+      }
+    },
     "node_modules/@jridgewell/sourcemap-codec": {
       "version": "1.5.5",
       "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
@@ -570,6 +720,17 @@
       "dev": true,
       "license": "MIT"
     },
+    "node_modules/@jridgewell/trace-mapping": {
+      "version": "0.3.31",
+      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",
+      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@jridgewell/resolve-uri": "^3.1.0",
+        "@jridgewell/sourcemap-codec": "^1.4.14"
+      }
+    },
     "node_modules/@nodelib/fs.scandir": {
       "version": "2.1.5",
       "resolved": "https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz",
@@ -608,6 +769,17 @@
         "node": ">= 8"
       }
     },
+    "node_modules/@pkgjs/parseargs": {
+      "version": "0.11.0",
+      "resolved": "https://registry.npmjs.org/@pkgjs/parseargs/-/parseargs-0.11.0.tgz",
+      "integrity": "sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==",
+      "dev": true,
+      "license": "MIT",
+      "optional": true,
+      "engines": {
+        "node": ">=14"
+      }
+    },
     "node_modules/@rollup/rollup-android-arm-eabi": {
       "version": "4.57.1",
       "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.57.1.tgz",
@@ -1042,7 +1214,6 @@
       "integrity": "sha512-m0jEgYlYz+mDJZ2+F4v8D1AyQb+QzsNqRuI7xg1VQX/KlKS0qT9r1Mo16yo5F/MtifXFgaofIFsdFMox2SxIbQ==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "undici-types": "~7.16.0"
       }
@@ -1141,7 +1312,6 @@
       "integrity": "sha512-4Z+L8I2OqhZV8qA132M4wNL30ypZGYOQVBfMgxDH/K5UX0PNqTu1c6za9ST5r9+tavvHiTWmBnKzpCJ/GlVFtg==",
       "dev": true,
       "license": "BSD-2-Clause",
-      "peer": true,
       "dependencies": {
         "@typescript-eslint/scope-manager": "7.18.0",
         "@typescript-eslint/types": "7.18.0",
@@ -1302,6 +1472,39 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/@vitest/coverage-v8": {
+      "version": "2.1.9",
+      "resolved": "https://registry.npmjs.org/@vitest/coverage-v8/-/coverage-v8-2.1.9.tgz",
+      "integrity": "sha512-Z2cOr0ksM00MpEfyVE8KXIYPEcBFxdbLSs56L8PO0QQMxt/6bDj45uQfxoc96v05KW3clk7vvgP0qfDit9DmfQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@ampproject/remapping": "^2.3.0",
+        "@bcoe/v8-coverage": "^0.2.3",
+        "debug": "^4.3.7",
+        "istanbul-lib-coverage": "^3.2.2",
+        "istanbul-lib-report": "^3.0.1",
+        "istanbul-lib-source-maps": "^5.0.6",
+        "istanbul-reports": "^3.1.7",
+        "magic-string": "^0.30.12",
+        "magicast": "^0.3.5",
+        "std-env": "^3.8.0",
+        "test-exclude": "^7.0.1",
+        "tinyrainbow": "^1.2.0"
+      },
+      "funding": {
+        "url": "https://opencollective.com/vitest"
+      },
+      "peerDependencies": {
+        "@vitest/browser": "2.1.9",
+        "vitest": "2.1.9"
+      },
+      "peerDependenciesMeta": {
+        "@vitest/browser": {
+          "optional": true
+        }
+      }
+    },
     "node_modules/@vitest/expect": {
       "version": "2.1.9",
       "resolved": "https://registry.npmjs.org/@vitest/expect/-/expect-2.1.9.tgz",
@@ -1434,7 +1637,6 @@
       "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "bin": {
         "acorn": "bin/acorn"
       },
@@ -1985,12 +2187,26 @@
         "node": ">= 0.4"
       }
     },
+    "node_modules/eastasianwidth": {
+      "version": "0.2.0",
+      "resolved": "https://registry.npmjs.org/eastasianwidth/-/eastasianwidth-0.2.0.tgz",
+      "integrity": "sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/ee-first": {
       "version": "1.1.1",
       "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
       "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
       "license": "MIT"
     },
+    "node_modules/emoji-regex": {
+      "version": "9.2.2",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
+      "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/encodeurl": {
       "version": "2.0.0",
       "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
@@ -2111,7 +2327,6 @@
       "deprecated": "This version is no longer supported. Please see https://eslint.org/version-support for other options.",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "@eslint-community/eslint-utils": "^4.2.0",
         "@eslint-community/regexpp": "^4.6.1",
@@ -2544,6 +2759,23 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/foreground-child": {
+      "version": "3.3.1",
+      "resolved": "https://registry.npmjs.org/foreground-child/-/foreground-child-3.3.1.tgz",
+      "integrity": "sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "cross-spawn": "^7.0.6",
+        "signal-exit": "^4.0.1"
+      },
+      "engines": {
+        "node": ">=14"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/forwarded": {
       "version": "0.2.0",
       "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
@@ -2791,6 +3023,13 @@
         "node": ">= 0.4"
       }
     },
+    "node_modules/html-escaper": {
+      "version": "2.0.2",
+      "resolved": "https://registry.npmjs.org/html-escaper/-/html-escaper-2.0.2.tgz",
+      "integrity": "sha512-H2iMtd0I4Mt5eYiapRdIDjp+XzelXQ0tFE4JS7YFwFevXXMmOp9myNrUvCg0D6ws8iqkRPBfKHgbwig1SmlLfg==",
+      "dev": true,
+      "license": "MIT"
+    },
     "node_modules/http-errors": {
       "version": "2.0.1",
       "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
@@ -2923,6 +3162,16 @@
         "node": ">=0.10.0"
       }
     },
+    "node_modules/is-fullwidth-code-point": {
+      "version": "3.0.0",
+      "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
+      "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=8"
+      }
+    },
     "node_modules/is-glob": {
       "version": "4.0.3",
       "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
@@ -2963,6 +3212,76 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/istanbul-lib-coverage": {
+      "version": "3.2.2",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-coverage/-/istanbul-lib-coverage-3.2.2.tgz",
+      "integrity": "sha512-O8dpsF+r0WV/8MNRKfnmrtCWhuKjxrq2w+jpzBL5UZKTi2LeVWnWOmWRxFlesJONmc+wLAGvKQZEOanko0LFTg==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/istanbul-lib-report": {
+      "version": "3.0.1",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-report/-/istanbul-lib-report-3.0.1.tgz",
+      "integrity": "sha512-GCfE1mtsHGOELCU8e/Z7YWzpmybrx/+dSTfLrvY8qRmaY6zXTKWn6WQIjaAFw069icm6GVMNkgu0NzI4iPZUNw==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "istanbul-lib-coverage": "^3.0.0",
+        "make-dir": "^4.0.0",
+        "supports-color": "^7.1.0"
+      },
+      "engines": {
+        "node": ">=10"
+      }
+    },
+    "node_modules/istanbul-lib-source-maps": {
+      "version": "5.0.6",
+      "resolved": "https://registry.npmjs.org/istanbul-lib-source-maps/-/istanbul-lib-source-maps-5.0.6.tgz",
+      "integrity": "sha512-yg2d+Em4KizZC5niWhQaIomgf5WlL4vOOjZ5xGCmF8SnPE/mDWWXgvRExdcpCgh9lLRRa1/fSYp2ymmbJ1pI+A==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "@jridgewell/trace-mapping": "^0.3.23",
+        "debug": "^4.1.1",
+        "istanbul-lib-coverage": "^3.0.0"
+      },
+      "engines": {
+        "node": ">=10"
+      }
+    },
+    "node_modules/istanbul-reports": {
+      "version": "3.2.0",
+      "resolved": "https://registry.npmjs.org/istanbul-reports/-/istanbul-reports-3.2.0.tgz",
+      "integrity": "sha512-HGYWWS/ehqTV3xN10i23tkPkpH46MLCIMFNCaaKNavAXTF1RkqxawEPtnjnGZ6XKSInBKkiOA5BKS+aZiY3AvA==",
+      "dev": true,
+      "license": "BSD-3-Clause",
+      "dependencies": {
+        "html-escaper": "^2.0.0",
+        "istanbul-lib-report": "^3.0.0"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/jackspeak": {
+      "version": "3.4.3",
+      "resolved": "https://registry.npmjs.org/jackspeak/-/jackspeak-3.4.3.tgz",
+      "integrity": "sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==",
+      "dev": true,
+      "license": "BlueOak-1.0.0",
+      "dependencies": {
+        "@isaacs/cliui": "^8.0.2"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      },
+      "optionalDependencies": {
+        "@pkgjs/parseargs": "^0.11.0"
+      }
+    },
     "node_modules/js-yaml": {
       "version": "4.1.1",
       "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.1.tgz",
@@ -3051,6 +3370,13 @@
       "dev": true,
       "license": "MIT"
     },
+    "node_modules/lru-cache": {
+      "version": "10.4.3",
+      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-10.4.3.tgz",
+      "integrity": "sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==",
+      "dev": true,
+      "license": "ISC"
+    },
     "node_modules/magic-string": {
       "version": "0.30.21",
       "resolved": "https://registry.npmjs.org/magic-string/-/magic-string-0.30.21.tgz",
@@ -3061,6 +3387,34 @@
         "@jridgewell/sourcemap-codec": "^1.5.5"
       }
     },
+    "node_modules/magicast": {
+      "version": "0.3.5",
+      "resolved": "https://registry.npmjs.org/magicast/-/magicast-0.3.5.tgz",
+      "integrity": "sha512-L0WhttDl+2BOsybvEOLK7fW3UA0OQ0IQ2d6Zl2x/a6vVRs3bAY0ECOSHHeL5jD+SbOpOCUEi0y1DgHEn9Qn1AQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "@babel/parser": "^7.25.4",
+        "@babel/types": "^7.25.4",
+        "source-map-js": "^1.2.0"
+      }
+    },
+    "node_modules/make-dir": {
+      "version": "4.0.0",
+      "resolved": "https://registry.npmjs.org/make-dir/-/make-dir-4.0.0.tgz",
+      "integrity": "sha512-hXdUTZYIVOt1Ex//jAQi+wTZZpUpwBj/0QsOzqegb3rGMMeJiSEu5xLHnYfBrRV4RH2+OCSOO95Is/7x1WJ4bw==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "semver": "^7.5.3"
+      },
+      "engines": {
+        "node": ">=10"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/sindresorhus"
+      }
+    },
     "node_modules/math-intrinsics": {
       "version": "1.1.0",
       "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
@@ -3191,6 +3545,16 @@
         "url": "https://github.com/sponsors/ljharb"
       }
     },
+    "node_modules/minipass": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
+      "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
+      "dev": true,
+      "license": "ISC",
+      "engines": {
+        "node": ">=16 || 14 >=14.17"
+      }
+    },
     "node_modules/mkdirp-classic": {
       "version": "0.5.3",
       "resolved": "https://registry.npmjs.org/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz",
@@ -3339,6 +3703,13 @@
         "url": "https://github.com/sponsors/sindresorhus"
       }
     },
+    "node_modules/package-json-from-dist": {
+      "version": "1.0.1",
+      "resolved": "https://registry.npmjs.org/package-json-from-dist/-/package-json-from-dist-1.0.1.tgz",
+      "integrity": "sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==",
+      "dev": true,
+      "license": "BlueOak-1.0.0"
+    },
     "node_modules/parent-module": {
       "version": "1.0.1",
       "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
@@ -3391,6 +3762,23 @@
         "node": ">=8"
       }
     },
+    "node_modules/path-scurry": {
+      "version": "1.11.1",
+      "resolved": "https://registry.npmjs.org/path-scurry/-/path-scurry-1.11.1.tgz",
+      "integrity": "sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==",
+      "dev": true,
+      "license": "BlueOak-1.0.0",
+      "dependencies": {
+        "lru-cache": "^10.2.0",
+        "minipass": "^5.0.0 || ^6.0.2 || ^7.0.0"
+      },
+      "engines": {
+        "node": ">=16 || 14 >=14.18"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/path-to-regexp": {
       "version": "0.1.12",
       "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-0.1.12.tgz",
@@ -3947,6 +4335,19 @@
       "dev": true,
       "license": "ISC"
     },
+    "node_modules/signal-exit": {
+      "version": "4.1.0",
+      "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
+      "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
+      "dev": true,
+      "license": "ISC",
+      "engines": {
+        "node": ">=14"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/simple-concat": {
       "version": "1.0.1",
       "resolved": "https://registry.npmjs.org/simple-concat/-/simple-concat-1.0.1.tgz",
@@ -4044,6 +4445,76 @@
         "safe-buffer": "~5.2.0"
       }
     },
+    "node_modules/string-width": {
+      "version": "5.1.2",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-5.1.2.tgz",
+      "integrity": "sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "eastasianwidth": "^0.2.0",
+        "emoji-regex": "^9.2.2",
+        "strip-ansi": "^7.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/sindresorhus"
+      }
+    },
+    "node_modules/string-width-cjs": {
+      "name": "string-width",
+      "version": "4.2.3",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
+      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "emoji-regex": "^8.0.0",
+        "is-fullwidth-code-point": "^3.0.0",
+        "strip-ansi": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/string-width-cjs/node_modules/emoji-regex": {
+      "version": "8.0.0",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
+      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
+      "dev": true,
+      "license": "MIT"
+    },
+    "node_modules/string-width/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/string-width/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
     "node_modules/strip-ansi": {
       "version": "6.0.1",
       "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
@@ -4057,6 +4528,20 @@
         "node": ">=8"
       }
     },
+    "node_modules/strip-ansi-cjs": {
+      "name": "strip-ansi",
+      "version": "6.0.1",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
+      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^5.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
     "node_modules/strip-json-comments": {
       "version": "3.1.1",
       "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
@@ -4111,6 +4596,43 @@
         "node": ">=6"
       }
     },
+    "node_modules/test-exclude": {
+      "version": "7.0.1",
+      "resolved": "https://registry.npmjs.org/test-exclude/-/test-exclude-7.0.1.tgz",
+      "integrity": "sha512-pFYqmTw68LXVjeWJMST4+borgQP2AyMNbg1BpZh9LbyhUeNkeaPF9gzfPGUAnSMV3qPYdWUwDIjjCLiSDOl7vg==",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "@istanbuljs/schema": "^0.1.2",
+        "glob": "^10.4.1",
+        "minimatch": "^9.0.4"
+      },
+      "engines": {
+        "node": ">=18"
+      }
+    },
+    "node_modules/test-exclude/node_modules/glob": {
+      "version": "10.5.0",
+      "resolved": "https://registry.npmjs.org/glob/-/glob-10.5.0.tgz",
+      "integrity": "sha512-DfXN8DfhJ7NH3Oe7cFmu3NCu1wKbkReJ8TorzSAFbSKrlNaQSKfIzqYqVY8zlbs2NLBbWpRiU52GX2PbaBVNkg==",
+      "deprecated": "Old versions of glob are not supported, and contain widely publicized security vulnerabilities, which have been fixed in the current version. Please update. Support for old versions may be purchased (at exorbitant rates) by contacting i@izs.me",
+      "dev": true,
+      "license": "ISC",
+      "dependencies": {
+        "foreground-child": "^3.1.0",
+        "jackspeak": "^3.1.2",
+        "minimatch": "^9.0.4",
+        "minipass": "^7.1.2",
+        "package-json-from-dist": "^1.0.0",
+        "path-scurry": "^1.11.1"
+      },
+      "bin": {
+        "glob": "dist/esm/bin.mjs"
+      },
+      "funding": {
+        "url": "https://github.com/sponsors/isaacs"
+      }
+    },
     "node_modules/text-table": {
       "version": "0.2.0",
       "resolved": "https://registry.npmjs.org/text-table/-/text-table-0.2.0.tgz",
@@ -4254,7 +4776,6 @@
       "integrity": "sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==",
       "dev": true,
       "license": "Apache-2.0",
-      "peer": true,
       "bin": {
         "tsc": "bin/tsc",
         "tsserver": "bin/tsserver"
@@ -4518,6 +5039,107 @@
         "node": ">=0.10.0"
       }
     },
+    "node_modules/wrap-ansi": {
+      "version": "8.1.0",
+      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-8.1.0.tgz",
+      "integrity": "sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-styles": "^6.1.0",
+        "string-width": "^5.0.1",
+        "strip-ansi": "^7.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi-cjs": {
+      "name": "wrap-ansi",
+      "version": "7.0.0",
+      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
+      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-styles": "^4.0.0",
+        "string-width": "^4.1.0",
+        "strip-ansi": "^6.0.0"
+      },
+      "engines": {
+        "node": ">=10"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi-cjs/node_modules/emoji-regex": {
+      "version": "8.0.0",
+      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
+      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
+      "dev": true,
+      "license": "MIT"
+    },
+    "node_modules/wrap-ansi-cjs/node_modules/string-width": {
+      "version": "4.2.3",
+      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
+      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "emoji-regex": "^8.0.0",
+        "is-fullwidth-code-point": "^3.0.0",
+        "strip-ansi": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=8"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/ansi-regex": {
+      "version": "6.2.2",
+      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.2.2.tgz",
+      "integrity": "sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-regex?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/ansi-styles": {
+      "version": "6.2.3",
+      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-6.2.3.tgz",
+      "integrity": "sha512-4Dj6M28JB+oAH8kFkTLUo+a2jwOFkuqb3yucU0CANcRRUbxS0cP0nZYCGjcc3BNXwRIsUVmDGgzawme7zvJHvg==",
+      "dev": true,
+      "license": "MIT",
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
+      }
+    },
+    "node_modules/wrap-ansi/node_modules/strip-ansi": {
+      "version": "7.1.2",
+      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.2.tgz",
+      "integrity": "sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==",
+      "dev": true,
+      "license": "MIT",
+      "dependencies": {
+        "ansi-regex": "^6.0.1"
+      },
+      "engines": {
+        "node": ">=12"
+      },
+      "funding": {
+        "url": "https://github.com/chalk/strip-ansi?sponsor=1"
+      }
+    },
     "node_modules/wrappy": {
       "version": "1.0.2",
       "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
diff --git a/src/analytics/index.ts b/src/analytics/index.ts
new file mode 100644
index 0000000..3258d21
--- /dev/null
+++ b/src/analytics/index.ts
@@ -0,0 +1,83 @@
+import { EventBus } from '../bus.js';
+import type {
+  AnalyticsService,
+  CartUpdatedEvent,
+  OrderCreatedEvent,
+  PaymentProcessedEvent,
+} from '../types.js';
+import { Events, PaymentStatus } from '../types.js';
+
+export function createAnalyticsService(bus: EventBus): AnalyticsService {
+  const eventCounts = new Map<string, number>();
+  let revenue = 0;
+  const uniqueCarts = new Set<string>();
+  let orderCount = 0;
+  const productCounts = new Map<string, number>();
+  const cartItems = new Map<string, Array<{ productId: string; quantity: number }>>();
+  const orderTotals = new Map<string, number>();
+
+  function trackEvent(eventName: string): void {
+    eventCounts.set(eventName, (eventCounts.get(eventName) ?? 0) + 1);
+  }
+
+  // Register a counting handler for every known event type
+  for (const eventName of Object.values(Events)) {
+    bus.on(eventName, () => {
+      trackEvent(eventName);
+    });
+  }
+
+  // Track cart contents and unique carts
+  bus.on(Events.CART_UPDATED, (payload: unknown) => {
+    const event = payload as CartUpdatedEvent;
+    uniqueCarts.add(event.cartId);
+    cartItems.set(event.cartId, event.items.map(i => ({ ...i })));
+  });
+
+  // Track orders, order totals, and product popularity
+  bus.on(Events.ORDER_CREATED, (payload: unknown) => {
+    const event = payload as OrderCreatedEvent;
+    orderCount++;
+    orderTotals.set(event.orderId, event.total);
+
+    const items = cartItems.get(event.cartId);
+    if (items) {
+      for (const item of items) {
+        productCounts.set(
+          item.productId,
+          (productCounts.get(item.productId) ?? 0) + item.quantity,
+        );
+      }
+    }
+  });
+
+  // Track revenue from successful payments
+  bus.on(Events.PAYMENT_PROCESSED, (payload: unknown) => {
+    const event = payload as PaymentProcessedEvent;
+    if (event.status === PaymentStatus.SUCCESS) {
+      revenue += orderTotals.get(event.orderId) ?? 0;
+    }
+  });
+
+  return {
+    getEventCount(eventType) {
+      return eventCounts.get(eventType) ?? 0;
+    },
+
+    getRevenue() {
+      return revenue;
+    },
+
+    getConversionRate() {
+      if (uniqueCarts.size === 0) return 0;
+      return orderCount / uniqueCarts.size;
+    },
+
+    getTopProducts(limit) {
+      return [...productCounts.entries()]
+        .map(([productId, count]) => ({ productId, count }))
+        .sort((a, b) => b.count - a.count)
+        .slice(0, limit);
+    },
+  };
+}
diff --git a/src/cart/index.ts b/src/cart/index.ts
new file mode 100644
index 0000000..0a332a3
--- /dev/null
+++ b/src/cart/index.ts
@@ -0,0 +1,82 @@
+import { v4 as uuidv4 } from 'uuid';
+import { EventBus } from '../bus.js';
+import type { CartService, CartUpdatedEvent } from '../types.js';
+import { Events } from '../types.js';
+
+interface CartItem {
+  productId: string;
+  quantity: number;
+}
+
+interface Cart {
+  id: string;
+  userId: string;
+  items: CartItem[];
+}
+
+export function createCartService(bus: EventBus): CartService {
+  const carts = new Map<string, Cart>();
+
+  function emitCartUpdate(cart: Cart): void {
+    const event: CartUpdatedEvent = {
+      cartId: cart.id,
+      userId: cart.userId,
+      items: cart.items.map(i => ({ ...i })),
+    };
+    void bus.emit(Events.CART_UPDATED, event);
+  }
+
+  return {
+    createCart(userId) {
+      const id = uuidv4();
+      carts.set(id, { id, userId, items: [] });
+      return id;
+    },
+
+    addItem(cartId, productId, quantity) {
+      const cart = carts.get(cartId);
+      if (!cart) return;
+      const existing = cart.items.find(i => i.productId === productId);
+      if (existing) {
+        existing.quantity += quantity;
+      } else {
+        cart.items.push({ productId, quantity });
+      }
+      emitCartUpdate(cart);
+    },
+
+    removeItem(cartId, productId) {
+      const cart = carts.get(cartId);
+      if (!cart) return;
+      cart.items = cart.items.filter(i => i.productId !== productId);
+      emitCartUpdate(cart);
+    },
+
+    getCart(cartId) {
+      const cart = carts.get(cartId);
+      if (!cart) return null;
+      return {
+        id: cart.id,
+        userId: cart.userId,
+        items: cart.items.map(i => ({ ...i })),
+      };
+    },
+
+    clearCart(cartId) {
+      const cart = carts.get(cartId);
+      if (!cart) return;
+      cart.items = [];
+      emitCartUpdate(cart);
+    },
+
+    updateQuantity(cartId, productId, quantity) {
+      const cart = carts.get(cartId);
+      if (!cart) return;
+      const item = cart.items.find(i => i.productId === productId);
+      if (item) {
+        item.quantity = quantity;
+        emitCartUpdate(cart);
+      }
+    },
+  };
+}
diff --git a/src/catalog/index.ts b/src/catalog/index.ts
new file mode 100644
index 0000000..a030fde
--- /dev/null
+++ b/src/catalog/index.ts
@@ -0,0 +1,56 @@
+import { v4 as uuidv4 } from 'uuid';
+import { EventBus } from '../bus.js';
+import type { CatalogService, ProductCreatedEvent } from '../types.js';
+import { Events } from '../types.js';
+
+interface Product {
+  id: string;
+  name: string;
+  price: number;
+  category: string;
+}
+
+export function createCatalogService(bus: EventBus): CatalogService {
+  const products = new Map<string, Product>();
+
+  return {
+    createProduct(name, price, category) {
+      const id = uuidv4();
+      products.set(id, { id, name, price, category });
+      const event: ProductCreatedEvent = { productId: id, name, price, category };
+      void bus.emit(Events.PRODUCT_CREATED, event);
+      return id;
+    },
+
+    getProduct(productId) {
+      const p = products.get(productId);
+      return p ? { ...p } : null;
+    },
+
+    listProducts(category?) {
+      const all = [...products.values()];
+      const filtered = category !== undefined
+        ? all.filter(p => p.category === category)
+        : all;
+      return filtered.map(p => ({ ...p }));
+    },
+
+    searchProducts(query) {
+      const lower = query.toLowerCase();
+      return [...products.values()]
+        .filter(p => p.name.toLowerCase().includes(lower))
+        .map(p => ({ ...p }));
+    },
+
+    updateProduct(productId, updates) {
+      const product = products.get(productId);
+      if (product) {
+        Object.assign(product, updates);
+      }
+    },
+
+    removeProduct(productId) {
+      return products.delete(productId);
+    },
+  };
+}
diff --git a/src/index.ts b/src/index.ts
new file mode 100644
index 0000000..386c592
--- /dev/null
+++ b/src/index.ts
@@ -0,0 +1,10 @@
+export { createCatalogService } from './catalog/index.js';
+export { createInventoryService } from './inventory/index.js';
+export { createCartService } from './cart/index.js';
+export { createPricingService } from './pricing/index.js';
+export { createOrderService } from './orders/index.js';
+export { createPaymentService } from './payment/index.js';
+export { createNotificationService } from './notifications/index.js';
+export { createAnalyticsService } from './analytics/index.js';
+export { EventBus } from './bus.js';
+export * from './types.js';
diff --git a/src/inventory/index.ts b/src/inventory/index.ts
new file mode 100644
index 0000000..8471fcc
--- /dev/null
+++ b/src/inventory/index.ts
@@ -0,0 +1,59 @@
+import { EventBus } from '../bus.js';
+import type { InventoryService, InventoryUpdatedEvent, LowStockAlertEvent } from '../types.js';
+import { Events } from '../types.js';
+
+export function createInventoryService(bus: EventBus): InventoryService {
+  const stock = new Map<string, number>();
+  const reserved = new Map<string, number>();
+  const thresholds = new Map<string, number>();
+
+  function getAvailable(productId: string): number {
+    return (stock.get(productId) ?? 0) - (reserved.get(productId) ?? 0);
+  }
+
+  function emitUpdate(productId: string): void {
+    const event: InventoryUpdatedEvent = { productId, quantity: getAvailable(productId) };
+    void bus.emit(Events.INVENTORY_UPDATED, event);
+  }
+
+  function checkLowStock(productId: string): void {
+    const threshold = thresholds.get(productId);
+    if (threshold !== undefined) {
+      const available = getAvailable(productId);
+      if (available <= threshold) {
+        const event: LowStockAlertEvent = { productId, currentQuantity: available, threshold };
+        void bus.emit(Events.LOW_STOCK_ALERT, event);
+      }
+    }
+  }
+
+  return {
+    setStock(productId, quantity) {
+      stock.set(productId, quantity);
+      emitUpdate(productId);
+      checkLowStock(productId);
+    },
+
+    getStock(productId) {
+      return getAvailable(productId);
+    },
+
+    reserve(productId, quantity) {
+      if (getAvailable(productId) < quantity) return false;
+      reserved.set(productId, (reserved.get(productId) ?? 0) + quantity);
+      emitUpdate(productId);
+      checkLowStock(productId);
+      return true;
+    },
+
+    release(productId, quantity) {
+      const current = reserved.get(productId) ?? 0;
+      reserved.set(productId, Math.max(0, current - quantity));
+      emitUpdate(productId);
+    },
+
+    setLowStockThreshold(productId, threshold) {
+      thresholds.set(productId, threshold);
+    },
+  };
+}
diff --git a/src/notifications/index.ts b/src/notifications/index.ts
new file mode 100644
index 0000000..8bf55c6
--- /dev/null
+++ b/src/notifications/index.ts
@@ -0,0 +1,77 @@
+import { EventBus } from '../bus.js';
+import type {
+  NotificationService,
+  OrderCreatedEvent,
+  OrderStatusChangedEvent,
+  PaymentProcessedEvent,
+  NotificationSentEvent,
+} from '../types.js';
+import { Events } from '../types.js';
+
+interface Notification {
+  type: string;
+  message: string;
+  timestamp: number;
+}
+
+export function createNotificationService(bus: EventBus): NotificationService {
+  const subscriptions = new Set<string>();
+  const notifications = new Map<string, Notification[]>();
+  const orderToUser = new Map<string, string>();
+
+  function addNotification(userId: string, type: string, message: string): void {
+    if (!subscriptions.has(userId)) return;
+
+    let list = notifications.get(userId);
+    if (!list) {
+      list = [];
+      notifications.set(userId, list);
+    }
+    list.push({ type, message, timestamp: Date.now() });
+
+    const event: NotificationSentEvent = { userId, type, message };
+    void bus.emit(Events.NOTIFICATION_SENT, event);
+  }
+
+  // Track order ownership
+  bus.on(Events.ORDER_CREATED, (payload: unknown) => {
+    const event = payload as OrderCreatedEvent;
+    orderToUser.set(event.orderId, event.userId);
+  });
+
+  // Notify on order status changes
+  bus.on(Events.ORDER_STATUS_CHANGED, (payload: unknown) => {
+    const event = payload as OrderStatusChangedEvent;
+    const userId = orderToUser.get(event.orderId);
+    if (userId) {
+      addNotification(
+        userId,
+        'order_status',
+        `Order ${event.orderId} status changed to ${event.status}`,
+      );
+    }
+  });
+
+  // Notify on payment events
+  bus.on(Events.PAYMENT_PROCESSED, (payload: unknown) => {
+    const event = payload as PaymentProcessedEvent;
+    const userId = orderToUser.get(event.orderId);
+    if (userId) {
+      addNotification(
+        userId,
+        'payment',
+        `Payment for order ${event.orderId}: ${event.status}`,
+      );
+    }
+  });
+
+  return {
+    subscribe(userId) {
+      subscriptions.add(userId);
+    },
+
+    getNotifications(userId) {
+      return (notifications.get(userId) ?? []).map(n => ({ ...n }));
+    },
+  };
+}
diff --git a/src/orders/index.ts b/src/orders/index.ts
new file mode 100644
index 0000000..caa46dc
--- /dev/null
+++ b/src/orders/index.ts
@@ -0,0 +1,47 @@
+import { v4 as uuidv4 } from 'uuid';
+import { EventBus } from '../bus.js';
+import type { OrderService, OrderCreatedEvent, OrderStatusChangedEvent } from '../types.js';
+import { OrderStatus, Events } from '../types.js';
+
+interface Order {
+  id: string;
+  userId: string;
+  cartId: string;
+  status: OrderStatus;
+  total: number;
+}
+
+export function createOrderService(bus: EventBus): OrderService {
+  const orders = new Map<string, Order>();
+
+  return {
+    createOrder(userId, cartId, total) {
+      const id = uuidv4();
+      orders.set(id, { id, userId, cartId, status: OrderStatus.PENDING, total });
+      const event: OrderCreatedEvent = { orderId: id, userId, cartId, total };
+      void bus.emit(Events.ORDER_CREATED, event);
+      return id;
+    },
+
+    getOrder(orderId) {
+      const order = orders.get(orderId);
+      if (!order) return null;
+      return { id: order.id, userId: order.userId, status: order.status, total: order.total };
+    },
+
+    updateStatus(orderId, status) {
+      const order = orders.get(orderId);
+      if (!order) return;
+      const previousStatus = order.status;
+      order.status = status;
+      const event: OrderStatusChangedEvent = { orderId, status, previousStatus };
+      void bus.emit(Events.ORDER_STATUS_CHANGED, event);
+    },
+
+    listOrders(userId) {
+      return [...orders.values()]
+        .filter(o => o.userId === userId)
+        .map(o => ({ id: o.id, status: o.status, total: o.total }));
+    },
+  };
+}
diff --git a/src/payment/index.ts b/src/payment/index.ts
new file mode 100644
index 0000000..76b3060
--- /dev/null
+++ b/src/payment/index.ts
@@ -0,0 +1,63 @@
+import { v4 as uuidv4 } from 'uuid';
+import { EventBus } from '../bus.js';
+import type { PaymentService, PaymentProcessedEvent } from '../types.js';
+import { PaymentStatus, Events } from '../types.js';
+
+export interface PaymentSimulationOptions {
+  mode?: 'success' | 'failure' | 'timeout';
+  delay?: number;
+}
+
+export function createPaymentService(
+  bus: EventBus,
+  options?: PaymentSimulationOptions,
+): PaymentService {
+  const transactions = new Map<
+    string,
+    { orderId: string; amount: number; status: PaymentStatus }
+  >();
+
+  return {
+    async processPayment(orderId, amount) {
+      const mode = options?.mode ?? 'success';
+      const delay = options?.delay ?? 0;
+
+      if (delay > 0) {
+        await new Promise<void>(resolve => setTimeout(resolve, delay));
+      }
+
+      let status: PaymentStatus;
+      let transactionId: string | undefined;
+      let error: string | undefined;
+
+      switch (mode) {
+        case 'failure':
+          status = PaymentStatus.FAILED;
+          error = 'Payment declined';
+          break;
+        case 'timeout':
+          status = PaymentStatus.TIMEOUT;
+          error = 'Payment timed out';
+          break;
+        default:
+          status = PaymentStatus.SUCCESS;
+          transactionId = uuidv4();
+          transactions.set(transactionId, { orderId, amount, status });
+          break;
+      }
+
+      const event: PaymentProcessedEvent = { orderId, status, transactionId, error };
+      await bus.emit(Events.PAYMENT_PROCESSED, event);
+
+      return { status, transactionId, error };
+    },
+
+    async refund(transactionId) {
+      const tx = transactions.get(transactionId);
+      if (!tx || tx.status !== PaymentStatus.SUCCESS) return false;
+      tx.status = PaymentStatus.FAILED;
+      transactions.delete(transactionId);
+      return true;
+    },
+  };
+}
diff --git a/src/pricing/index.ts b/src/pricing/index.ts
new file mode 100644
index 0000000..9ab35af
--- /dev/null
+++ b/src/pricing/index.ts
@@ -0,0 +1,43 @@
+import { EventBus } from '../bus.js';
+import type { PricingService, ProductCreatedEvent } from '../types.js';
+import { Events } from '../types.js';
+
+const TAX_RATE = 0.10;
+
+export function createPricingService(bus: EventBus): PricingService {
+  const prices = new Map<string, number>();
+  const discountCodes = new Map<string, number>();
+
+  bus.on(Events.PRODUCT_CREATED, (payload: unknown) => {
+    const event = payload as ProductCreatedEvent;
+    prices.set(event.productId, event.price);
+  });
+
+  return {
+    calculateTotal(items, discountCode?) {
+      const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
+
+      let discount = 0;
+      if (discountCode) {
+        const percentage = discountCodes.get(discountCode);
+        if (percentage !== undefined) {
+          discount = subtotal * (percentage / 100);
+        }
+      }
+
+      const afterDiscount = subtotal - discount;
+      const tax = afterDiscount * TAX_RATE;
+      const total = afterDiscount + tax;
+
+      return { subtotal, discount, tax, total };
+    },
+
+    addDiscountCode(code, percentage) {
+      discountCodes.set(code, percentage);
+    },
+
+    getPrice(productId) {
+      return prices.get(productId) ?? 0;
+    },
+  };
+}
diff --git a/tests/services.test.ts b/tests/services.test.ts
new file mode 100644
index 0000000..71fa796
--- /dev/null
+++ b/tests/services.test.ts
@@ -0,0 +1,656 @@
+import { describe, it, expect, beforeEach } from 'vitest';
+import { EventBus } from '../src/bus.js';
+import { Events, OrderStatus, PaymentStatus } from '../src/types.js';
+import { createCatalogService } from '../src/catalog/index.js';
+import { createInventoryService } from '../src/inventory/index.js';
+import { createCartService } from '../src/cart/index.js';
+import { createPricingService } from '../src/pricing/index.js';
+import { createOrderService } from '../src/orders/index.js';
+import { createPaymentService } from '../src/payment/index.js';
+import { createNotificationService } from '../src/notifications/index.js';
+import { createAnalyticsService } from '../src/analytics/index.js';
+
+// Helper to flush pending async event handlers fired via `void bus.emit(...)`
+async function flush(): Promise<void> {
+  await new Promise<void>(r => setTimeout(r, 0));
+}
+
+// â”€â”€â”€ Catalog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('CatalogService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('creates a product and returns an id', () => {
+    const catalog = createCatalogService(bus);
+    const id = catalog.createProduct('Widget', 9.99, 'gadgets');
+    expect(id).toBeTruthy();
+  });
+
+  it('retrieves a product by id', () => {
+    const catalog = createCatalogService(bus);
+    const id = catalog.createProduct('Widget', 9.99, 'gadgets');
+    const product = catalog.getProduct(id);
+    expect(product).toEqual({ id, name: 'Widget', price: 9.99, category: 'gadgets' });
+  });
+
+  it('returns null for unknown product', () => {
+    const catalog = createCatalogService(bus);
+    expect(catalog.getProduct('nope')).toBeNull();
+  });
+
+  it('lists all products', () => {
+    const catalog = createCatalogService(bus);
+    catalog.createProduct('A', 1, 'x');
+    catalog.createProduct('B', 2, 'y');
+    expect(catalog.listProducts()).toHaveLength(2);
+  });
+
+  it('filters products by category', () => {
+    const catalog = createCatalogService(bus);
+    catalog.createProduct('A', 1, 'x');
+    catalog.createProduct('B', 2, 'y');
+    catalog.createProduct('C', 3, 'x');
+    expect(catalog.listProducts('x')).toHaveLength(2);
+  });
+
+  it('searches products by name (case-insensitive)', () => {
+    const catalog = createCatalogService(bus);
+    catalog.createProduct('Blue Widget', 1, 'gadgets');
+    catalog.createProduct('Red Gizmo', 2, 'gadgets');
+    const results = catalog.searchProducts('widget');
+    expect(results).toHaveLength(1);
+    expect(results[0].name).toBe('Blue Widget');
+  });
+
+  it('updates a product', () => {
+    const catalog = createCatalogService(bus);
+    const id = catalog.createProduct('Widget', 9.99, 'gadgets');
+    catalog.updateProduct(id, { price: 12.99 });
+    expect(catalog.getProduct(id)?.price).toBe(12.99);
+  });
+
+  it('removes a product', () => {
+    const catalog = createCatalogService(bus);
+    const id = catalog.createProduct('Widget', 9.99, 'gadgets');
+    expect(catalog.removeProduct(id)).toBe(true);
+    expect(catalog.getProduct(id)).toBeNull();
+    expect(catalog.removeProduct('nope')).toBe(false);
+  });
+
+  it('emits product:created event', async () => {
+    const catalog = createCatalogService(bus);
+    catalog.createProduct('Widget', 9.99, 'gadgets');
+    await flush();
+    const log = bus.getLog();
+    expect(log.some(e => e.event === Events.PRODUCT_CREATED)).toBe(true);
+  });
+});
+
+// â”€â”€â”€ Inventory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('InventoryService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('sets and gets stock', () => {
+    const inv = createInventoryService(bus);
+    inv.setStock('p1', 100);
+    expect(inv.getStock('p1')).toBe(100);
+  });
+
+  it('returns 0 for unknown product', () => {
+    const inv = createInventoryService(bus);
+    expect(inv.getStock('nope')).toBe(0);
+  });
+
+  it('reserves stock successfully', () => {
+    const inv = createInventoryService(bus);
+    inv.setStock('p1', 10);
+    expect(inv.reserve('p1', 5)).toBe(true);
+    expect(inv.getStock('p1')).toBe(5);
+  });
+
+  it('fails to reserve when insufficient stock', () => {
+    const inv = createInventoryService(bus);
+    inv.setStock('p1', 3);
+    expect(inv.reserve('p1', 5)).toBe(false);
+    expect(inv.getStock('p1')).toBe(3);
+  });
+
+  it('releases reserved stock', () => {
+    const inv = createInventoryService(bus);
+    inv.setStock('p1', 10);
+    inv.reserve('p1', 5);
+    inv.release('p1', 3);
+    expect(inv.getStock('p1')).toBe(8); // 10 - 5 + 3
+  });
+
+  it('emits low stock alert when threshold breached', async () => {
+    const inv = createInventoryService(bus);
+    const alerts: unknown[] = [];
+    bus.on(Events.LOW_STOCK_ALERT, (payload) => { alerts.push(payload); });
+
+    inv.setLowStockThreshold('p1', 5);
+    inv.setStock('p1', 10);
+    await flush();
+    expect(alerts).toHaveLength(0);
+
+    inv.reserve('p1', 6); // available = 4, below threshold 5
+    await flush();
+    expect(alerts.length).toBeGreaterThan(0);
+  });
+
+  it('emits inventory:updated on stock changes', async () => {
+    const inv = createInventoryService(bus);
+    inv.setStock('p1', 50);
+    await flush();
+    const log = bus.getLog();
+    expect(log.some(e => e.event === Events.INVENTORY_UPDATED)).toBe(true);
+  });
+});
+
+// â”€â”€â”€ Cart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('CartService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('creates a cart and returns id', () => {
+    const cart = createCartService(bus);
+    const id = cart.createCart('user1');
+    expect(id).toBeTruthy();
+  });
+
+  it('adds items to a cart', () => {
+    const svc = createCartService(bus);
+    const cartId = svc.createCart('user1');
+    svc.addItem(cartId, 'p1', 2);
+    const c = svc.getCart(cartId);
+    expect(c?.items).toEqual([{ productId: 'p1', quantity: 2 }]);
+  });
+
+  it('consolidates duplicate product additions', () => {
+    const svc = createCartService(bus);
+    const cartId = svc.createCart('user1');
+    svc.addItem(cartId, 'p1', 2);
+    svc.addItem(cartId, 'p1', 3);
+    const c = svc.getCart(cartId);
+    expect(c?.items).toEqual([{ productId: 'p1', quantity: 5 }]);
+  });
+
+  it('removes items from a cart', () => {
+    const svc = createCartService(bus);
+    const cartId = svc.createCart('user1');
+    svc.addItem(cartId, 'p1', 2);
+    svc.addItem(cartId, 'p2', 1);
+    svc.removeItem(cartId, 'p1');
+    expect(svc.getCart(cartId)?.items).toEqual([{ productId: 'p2', quantity: 1 }]);
+  });
+
+  it('updates quantity', () => {
+    const svc = createCartService(bus);
+    const cartId = svc.createCart('user1');
+    svc.addItem(cartId, 'p1', 2);
+    svc.updateQuantity(cartId, 'p1', 10);
+    expect(svc.getCart(cartId)?.items).toEqual([{ productId: 'p1', quantity: 10 }]);
+  });
+
+  it('clears a cart', () => {
+    const svc = createCartService(bus);
+    const cartId = svc.createCart('user1');
+    svc.addItem(cartId, 'p1', 2);
+    svc.clearCart(cartId);
+    expect(svc.getCart(cartId)?.items).toEqual([]);
+  });
+
+  it('returns null for unknown cart', () => {
+    const svc = createCartService(bus);
+    expect(svc.getCart('nope')).toBeNull();
+  });
+});
+
+// â”€â”€â”€ Pricing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('PricingService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('calculates total with 10% tax', () => {
+    const pricing = createPricingService(bus);
+    const result = pricing.calculateTotal([
+      { productId: 'p1', quantity: 2, price: 10 },
+    ]);
+    expect(result.subtotal).toBe(20);
+    expect(result.discount).toBe(0);
+    expect(result.tax).toBe(2);
+    expect(result.total).toBe(22);
+  });
+
+  it('applies percentage discount before tax', () => {
+    const pricing = createPricingService(bus);
+    pricing.addDiscountCode('SAVE10', 10);
+    const result = pricing.calculateTotal(
+      [{ productId: 'p1', quantity: 1, price: 100 }],
+      'SAVE10',
+    );
+    // subtotal=100, discount=10, afterDiscount=90, tax=9, total=99
+    expect(result.subtotal).toBe(100);
+    expect(result.discount).toBe(10);
+    expect(result.tax).toBe(9);
+    expect(result.total).toBe(99);
+  });
+
+  it('ignores unknown discount codes', () => {
+    const pricing = createPricingService(bus);
+    const result = pricing.calculateTotal(
+      [{ productId: 'p1', quantity: 1, price: 50 }],
+      'BADCODE',
+    );
+    expect(result.discount).toBe(0);
+    expect(result.total).toBe(55); // 50 + 5 tax
+  });
+
+  it('tracks prices from product:created events', async () => {
+    const pricing = createPricingService(bus);
+    await bus.emit(Events.PRODUCT_CREATED, {
+      productId: 'p1',
+      name: 'Widget',
+      price: 29.99,
+      category: 'gadgets',
+    });
+    expect(pricing.getPrice('p1')).toBe(29.99);
+  });
+
+  it('returns 0 for unknown product price', () => {
+    const pricing = createPricingService(bus);
+    expect(pricing.getPrice('unknown')).toBe(0);
+  });
+});
+
+// â”€â”€â”€ Orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('OrderService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('creates an order in PENDING status', () => {
+    const orders = createOrderService(bus);
+    const id = orders.createOrder('user1', 'cart1', 100);
+    const order = orders.getOrder(id);
+    expect(order?.status).toBe(OrderStatus.PENDING);
+    expect(order?.total).toBe(100);
+    expect(order?.userId).toBe('user1');
+  });
+
+  it('returns null for unknown order', () => {
+    const orders = createOrderService(bus);
+    expect(orders.getOrder('nope')).toBeNull();
+  });
+
+  it('updates order status with previous status tracking', async () => {
+    const orders = createOrderService(bus);
+    const statusEvents: unknown[] = [];
+    bus.on(Events.ORDER_STATUS_CHANGED, (p) => { statusEvents.push(p); });
+
+    const id = orders.createOrder('user1', 'cart1', 100);
+    orders.updateStatus(id, OrderStatus.CONFIRMED);
+    await flush();
+
+    expect(orders.getOrder(id)?.status).toBe(OrderStatus.CONFIRMED);
+    expect(statusEvents).toHaveLength(1);
+    const evt = statusEvents[0] as { orderId: string; status: string; previousStatus: string };
+    expect(evt.previousStatus).toBe(OrderStatus.PENDING);
+    expect(evt.status).toBe(OrderStatus.CONFIRMED);
+  });
+
+  it('supports the full status lifecycle', () => {
+    const orders = createOrderService(bus);
+    const id = orders.createOrder('user1', 'cart1', 50);
+    orders.updateStatus(id, OrderStatus.CONFIRMED);
+    orders.updateStatus(id, OrderStatus.SHIPPED);
+    orders.updateStatus(id, OrderStatus.DELIVERED);
+    expect(orders.getOrder(id)?.status).toBe(OrderStatus.DELIVERED);
+  });
+
+  it('supports cancellation', () => {
+    const orders = createOrderService(bus);
+    const id = orders.createOrder('user1', 'cart1', 50);
+    orders.updateStatus(id, OrderStatus.CANCELLED);
+    expect(orders.getOrder(id)?.status).toBe(OrderStatus.CANCELLED);
+  });
+
+  it('lists orders by user', () => {
+    const orders = createOrderService(bus);
+    orders.createOrder('user1', 'c1', 10);
+    orders.createOrder('user2', 'c2', 20);
+    orders.createOrder('user1', 'c3', 30);
+    expect(orders.listOrders('user1')).toHaveLength(2);
+    expect(orders.listOrders('user2')).toHaveLength(1);
+    expect(orders.listOrders('user3')).toHaveLength(0);
+  });
+
+  it('emits order:created event', async () => {
+    const orders = createOrderService(bus);
+    orders.createOrder('user1', 'cart1', 100);
+    await flush();
+    const log = bus.getLog();
+    expect(log.some(e => e.event === Events.ORDER_CREATED)).toBe(true);
+  });
+});
+
+// â”€â”€â”€ Payment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('PaymentService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('processes payment successfully by default', async () => {
+    const payment = createPaymentService(bus);
+    const result = await payment.processPayment('order1', 100);
+    expect(result.status).toBe(PaymentStatus.SUCCESS);
+    expect(result.transactionId).toBeTruthy();
+    expect(result.error).toBeUndefined();
+  });
+
+  it('simulates failure', async () => {
+    const payment = createPaymentService(bus, { mode: 'failure' });
+    const result = await payment.processPayment('order1', 100);
+    expect(result.status).toBe(PaymentStatus.FAILED);
+    expect(result.error).toBeTruthy();
+  });
+
+  it('simulates timeout', async () => {
+    const payment = createPaymentService(bus, { mode: 'timeout' });
+    const result = await payment.processPayment('order1', 100);
+    expect(result.status).toBe(PaymentStatus.TIMEOUT);
+    expect(result.error).toBeTruthy();
+  });
+
+  it('emits payment:processed event', async () => {
+    const payment = createPaymentService(bus);
+    await payment.processPayment('order1', 100);
+    const log = bus.getLog();
+    expect(log.some(e => e.event === Events.PAYMENT_PROCESSED)).toBe(true);
+  });
+
+  it('refunds a successful transaction', async () => {
+    const payment = createPaymentService(bus);
+    const result = await payment.processPayment('order1', 100);
+    const refunded = await payment.refund(result.transactionId!);
+    expect(refunded).toBe(true);
+  });
+
+  it('refuses to refund unknown transaction', async () => {
+    const payment = createPaymentService(bus);
+    const refunded = await payment.refund('no-such-tx');
+    expect(refunded).toBe(false);
+  });
+
+  it('refuses to double-refund', async () => {
+    const payment = createPaymentService(bus);
+    const result = await payment.processPayment('order1', 100);
+    await payment.refund(result.transactionId!);
+    const second = await payment.refund(result.transactionId!);
+    expect(second).toBe(false);
+  });
+});
+
+// â”€â”€â”€ Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('NotificationService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('returns empty array for user with no notifications', () => {
+    const notif = createNotificationService(bus);
+    expect(notif.getNotifications('user1')).toEqual([]);
+  });
+
+  it('delivers notifications for order status changes to subscribed users', async () => {
+    const notif = createNotificationService(bus);
+    const orders = createOrderService(bus);
+
+    notif.subscribe('user1');
+    const orderId = orders.createOrder('user1', 'cart1', 100);
+    await flush();
+
+    orders.updateStatus(orderId, OrderStatus.CONFIRMED);
+    await flush();
+
+    const notes = notif.getNotifications('user1');
+    expect(notes.length).toBeGreaterThanOrEqual(1);
+    expect(notes.some(n => n.type === 'order_status')).toBe(true);
+  });
+
+  it('delivers notifications for payment events to subscribed users', async () => {
+    const notif = createNotificationService(bus);
+    const orders = createOrderService(bus);
+    const payment = createPaymentService(bus);
+
+    notif.subscribe('user1');
+    const orderId = orders.createOrder('user1', 'cart1', 100);
+    await flush();
+
+    await payment.processPayment(orderId, 100);
+
+    const notes = notif.getNotifications('user1');
+    expect(notes.some(n => n.type === 'payment')).toBe(true);
+  });
+
+  it('does NOT deliver notifications to unsubscribed users', async () => {
+    const notif = createNotificationService(bus);
+    const orders = createOrderService(bus);
+
+    // Do NOT subscribe user1
+    const orderId = orders.createOrder('user1', 'cart1', 100);
+    await flush();
+    orders.updateStatus(orderId, OrderStatus.CONFIRMED);
+    await flush();
+
+    expect(notif.getNotifications('user1')).toEqual([]);
+  });
+});
+
+// â”€â”€â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('AnalyticsService', () => {
+  let bus: EventBus;
+
+  beforeEach(() => {
+    bus = new EventBus();
+  });
+
+  it('counts events by type', async () => {
+    const analytics = createAnalyticsService(bus);
+    const catalog = createCatalogService(bus);
+
+    catalog.createProduct('A', 10, 'x');
+    catalog.createProduct('B', 20, 'y');
+    await flush();
+
+    expect(analytics.getEventCount(Events.PRODUCT_CREATED)).toBe(2);
+  });
+
+  it('tracks revenue from successful payments', async () => {
+    const analytics = createAnalyticsService(bus);
+    const orders = createOrderService(bus);
+    const payment = createPaymentService(bus);
+
+    const orderId = orders.createOrder('user1', 'cart1', 150);
+    await flush();
+
+    await payment.processPayment(orderId, 150);
+    expect(analytics.getRevenue()).toBe(150);
+  });
+
+  it('does not count revenue from failed payments', async () => {
+    const analytics = createAnalyticsService(bus);
+    const orders = createOrderService(bus);
+    const payment = createPaymentService(bus, { mode: 'failure' });
+
+    const orderId = orders.createOrder('user1', 'cart1', 150);
+    await flush();
+
+    await payment.processPayment(orderId, 150);
+    expect(analytics.getRevenue()).toBe(0);
+  });
+
+  it('calculates conversion rate (orders / unique carts)', async () => {
+    const analytics = createAnalyticsService(bus);
+    const cartSvc = createCartService(bus);
+    const orders = createOrderService(bus);
+
+    const c1 = cartSvc.createCart('user1');
+    cartSvc.addItem(c1, 'p1', 1);
+    await flush();
+
+    const c2 = cartSvc.createCart('user2');
+    cartSvc.addItem(c2, 'p2', 1);
+    await flush();
+
+    // Only one cart converts to an order
+    orders.createOrder('user1', c1, 50);
+    await flush();
+
+    // 1 order / 2 unique carts = 0.5
+    expect(analytics.getConversionRate()).toBe(0.5);
+  });
+
+  it('returns 0 conversion rate when no carts', () => {
+    const analytics = createAnalyticsService(bus);
+    expect(analytics.getConversionRate()).toBe(0);
+  });
+
+  it('ranks top products by order quantity', async () => {
+    const analytics = createAnalyticsService(bus);
+    const cartSvc = createCartService(bus);
+    const orders = createOrderService(bus);
+
+    // Cart 1: 3x p1, 1x p2
+    const c1 = cartSvc.createCart('user1');
+    cartSvc.addItem(c1, 'p1', 3);
+    cartSvc.addItem(c1, 'p2', 1);
+    await flush();
+
+    orders.createOrder('user1', c1, 100);
+    await flush();
+
+    // Cart 2: 2x p2
+    const c2 = cartSvc.createCart('user2');
+    cartSvc.addItem(c2, 'p2', 2);
+    await flush();
+
+    orders.createOrder('user2', c2, 50);
+    await flush();
+
+    const top = analytics.getTopProducts(5);
+    // p1: 3, p2: 1+2=3 â€” both have 3, either order is fine
+    expect(top).toHaveLength(2);
+    expect(top[0].count).toBe(3);
+    expect(top[1].count).toBe(3);
+  });
+});
+
+// â”€â”€â”€ Integration: end-to-end flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+
+describe('End-to-end integration', () => {
+  it('complete purchase flow across all services', async () => {
+    const bus = new EventBus();
+
+    const catalog = createCatalogService(bus);
+    const inventory = createInventoryService(bus);
+    const cartSvc = createCartService(bus);
+    const pricing = createPricingService(bus);
+    const orders = createOrderService(bus);
+    const payment = createPaymentService(bus);
+    const notifications = createNotificationService(bus);
+    const analytics = createAnalyticsService(bus);
+
+    // 1. Create products
+    const prodId = catalog.createProduct('Laptop', 999, 'electronics');
+    await flush();
+
+    // 2. Stock inventory
+    inventory.setStock(prodId, 50);
+    inventory.setLowStockThreshold(prodId, 5);
+
+    // 3. Pricing picks up the product price via event
+    expect(pricing.getPrice(prodId)).toBe(999);
+
+    // 4. Create cart and add items
+    const cartId = cartSvc.createCart('alice');
+    cartSvc.addItem(cartId, prodId, 2);
+    await flush();
+
+    // 5. Calculate total
+    const cart = cartSvc.getCart(cartId)!;
+    const priceResult = pricing.calculateTotal(
+      cart.items.map(i => ({
+        productId: i.productId,
+        quantity: i.quantity,
+        price: pricing.getPrice(i.productId),
+      })),
+    );
+    expect(priceResult.subtotal).toBe(1998);
+    expect(priceResult.tax).toBeCloseTo(199.8);
+    expect(priceResult.total).toBeCloseTo(2197.8);
+
+    // 6. Reserve inventory
+    expect(inventory.reserve(prodId, 2)).toBe(true);
+    expect(inventory.getStock(prodId)).toBe(48);
+
+    // 7. Subscribe user for notifications
+    notifications.subscribe('alice');
+
+    // 8. Create order
+    const orderId = orders.createOrder('alice', cartId, priceResult.total);
+    await flush();
+
+    expect(orders.getOrder(orderId)?.status).toBe(OrderStatus.PENDING);
+
+    // 9. Process payment
+    const payResult = await payment.processPayment(orderId, priceResult.total);
+    expect(payResult.status).toBe(PaymentStatus.SUCCESS);
+
+    // 10. Confirm order
+    orders.updateStatus(orderId, OrderStatus.CONFIRMED);
+    await flush();
+
+    expect(orders.getOrder(orderId)?.status).toBe(OrderStatus.CONFIRMED);
+
+    // 11. Check notifications were delivered
+    const notes = notifications.getNotifications('alice');
+    expect(notes.length).toBeGreaterThanOrEqual(2); // payment + status change
+
+    // 12. Check analytics
+    expect(analytics.getEventCount(Events.ORDER_CREATED)).toBe(1);
+    expect(analytics.getRevenue()).toBeCloseTo(2197.8);
+    expect(analytics.getConversionRate()).toBe(1); // 1 order / 1 unique cart
+    const topProducts = analytics.getTopProducts(1);
+    expect(topProducts).toHaveLength(1);
+    expect(topProducts[0].productId).toBe(prodId);
+    expect(topProducts[0].count).toBe(2);
+  });
+});
