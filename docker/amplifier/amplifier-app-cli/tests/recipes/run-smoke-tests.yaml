name: "run-smoke-tests"
description: "Execute smoke tests in parallel and report results"
version: "1.0.0"
author: "Amplifier Testing Team"
created: "2025-12-23T00:00:00Z"
tags: ["testing", "smoke-tests", "orchestration", "parallel"]

# Recursion limits for orchestration
recursion:
  max_depth: 3
  max_total_steps: 50

context:
  # List of smoke test recipes to execute
  smoke_tests:
    - "smoke/agent-spawning.yaml"
    - "smoke/tool-loading.yaml"

steps:
  # Step 1: Execute all smoke tests in parallel
  - id: "run-tests"
    type: "recipe"
    foreach: "{{smoke_tests}}"
    as: "test_recipe"
    parallel: true
    collect: "test_results"
    recipe: "{{test_recipe}}"
    context: {}
    timeout: 600
    retry:
      max_attempts: 2
      backoff: "exponential"
      initial_delay: 5
    on_error: "continue"

  # Step 2: Synthesize test results and generate summary report
  - id: "synthesize-results"
    agent: "foundation:zen-architect"
    mode: "ANALYZE"
    prompt: |
      Analyze these smoke test results and generate a comprehensive summary report:

      Test Results:
      {{test_results}}

      Generate a summary report with:
      1. **Test Suite**: Smoke Tests
      2. **Total Tests Run**: [count]
      3. **Tests Passed**: [count]
      4. **Tests Failed**: [count]
      5. **Pass Rate**: [percentage]
      6. **Execution Summary**: Brief overview
      7. **Failures Details**: If any tests failed, provide details
      8. **Overall Status**: PASS or FAIL

      Format the report in clear markdown with sections for easy scanning.
    output: "summary_report"
    timeout: 300

  # Step 3: Final validation with clear pass/fail verdict
  - id: "validate-results"
    agent: "recipes:result-validator"
    prompt: |
      Validate the smoke test suite results and provide a clear verdict.

      Summary Report:
      {{summary_report}}

      Validation Criteria:
      - ALL smoke tests must pass
      - Any single failure means the suite fails
      - Report must clearly indicate pass/fail status

      Provide your verdict in this exact format:

      VERDICT: [SMOKE_TESTS_PASS or SMOKE_TESTS_FAIL]

      RATIONALE:
      [Brief explanation of verdict]

      RECOMMENDATION:
      [Action items if tests failed, or confirmation if passed]
    output: "final_verdict"
    timeout: 180

# Usage:
#   In session: "run the smoke tests recipe"
#   CLI: amplifier tool invoke recipes operation=execute recipe_path=tests/recipes/run-smoke-tests.yaml
#
# This orchestrator:
# - Runs 2 smoke tests in parallel for speed
# - Collects all results automatically
# - Generates comprehensive summary report
# - Provides clear PASS/FAIL verdict
# - Continues execution even if individual tests fail (to get full picture)
